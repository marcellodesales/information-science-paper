%% 
%% Copyright 2007, 2008, 2009 Elsevier Ltd
%% 
%% This file is part of the 'Elsarticle Bundle'.
%% ---------------------------------------------
%% 
%% It may be distributed under the conditions of the LaTeX Project Public
%% License, either version 1.2 of this license or (at your option) any
%% later version.  The latest version of this license is in
%%    http://www.latex-project.org/lppl.txt
%% and version 1.2 or later is part of all distributions of LaTeX
%% version 1999/12/01 or later.
%% 
%% The list of all files belonging to the 'Elsarticle Bundle' is
%% given in the file `manifest.txt'.
%% 

%% Template article for Elsevier's document class `elsarticle'
%% with numbered style bibliographic references
%% SP 2008/03/01

\documentclass[preprint,12pt]{elsarticle}
%\makeatletter
%\def\@author#1{\g@addto@macro\elsauthors{\normalsize%
%    \def\baselinestretch{1}%
%    \upshape\authorsep#1\unskip\textsuperscript{%
%      \ifx\@fnmark\@empty\else\unskip\sep\@fnmark\let\sep=,\fi
%      \ifx\@corref\@empty\else\unskip\sep\@corref\let\sep=,\fi
%      }%
%    \def\authorsep{\unskip,\space}%
%    \global\let\@fnmark\@empty
%    \global\let\@corref\@empty  %% Added
%    \global\let\sep\@empty}%
%    \@eadauthor={#1}
%}
%\makeatother
%% Use the option review to obtain double line spacing
%% \documentclass[authoryear,preprint,review,12pt]{elsarticle}

%% Use the options 1p,twocolumn; 3p; 3p,twocolumn; 5p; or 5p,twocolumn
%% for a journal layout:
%% \documentclass[final,1p,times]{elsarticle}
%% \documentclass[final,1p,times,twocolumn]{elsarticle}
%% \documentclass[final,3p,times]{elsarticle}
%% \documentclass[final,3p,times,twocolumn]{elsarticle}
%% \documentclass[final,5p,times]{elsarticle}
%% \documentclass[final,5p,times,twocolumn]{elsarticle}

%% For including figures, graphicx.sty has been loaded in
%% elsarticle.cls. If you prefer to use the old commands
%% please give \usepackage{epsfig}

%% The amssymb package provides various useful mathematical symbols
\usepackage{amssymb}
\usepackage{amsthm}
%\usepackage[pdftex]{graphicx}
\usepackage{color}
\usepackage{listings}
\usepackage{subfig}
\usepackage{float}
\usepackage{longtable}
\usepackage{supertabular}
\usepackage{pbox}
\usepackage{amsmath}
%\usepackage{tablefootnote}
%
%
%\usepackage{booktabs}
%\captionsetup[table]{position=top,labelfont={sc},textfont={sl}}
%\renewcommand{\thetable}{\Roman {table}}

% correct bad hyphenation here
%\definecolor{gray}{rgb}{255,255,255}

\lstloadlanguages{HTML,XML}
\lstset{%
language=XML,
frame=tb,
framerule=1pt,
rulesep=0pt,
basicstyle=\scriptsize,
showstringspaces=false,
numbers=left,
numberstyle=\scriptsize,
stepnumber=1,
numbersep=2pt,
%backgroundcolor=\color{gray},
showspaces=false,
showtabs=false,
escapeinside={\%*}{*)}
}

\mathchardef\mhyphen="2D


\hyphenation{a-no-ny-mi-ty VA-NET}
\newtheorem{definition}{Definition}
\newcommand{\protocolname}{$ASAP$-V} 
%% The amsthm package provides extended theorem environments
%% \usepackage{amsthm}

%% The lineno packages adds line numbers. Start line numbering with
%% \begin{linenumbers}, end it with \end{linenumbers}. Or switch it on
%% for the whole article with \linenumbers.
%% \usepackage{lineno}

\journal{Information Sciences}

\begin{document}

\begin{frontmatter}

%% Title, authors and addresses

%% use the tnoteref command within \title for footnotes;
%% use the tnotetext command for theassociated footnote;
%% use the fnref command within \author or \address for footnotes;
%% use the fntext command for theassociated footnote;
%% use the corref command within \author for corresponding author footnotes;
%% use the cortext command for theassociated footnote;
%% use the ead command for the email address,
%% and the form \ead[url] for the home page:
%% \title{Title\tnoteref{label1}}
%% \tnotetext[label1]{}
%% \author{Name\corref{cor1}\fnref{label2}}
%% \ead{email address}
%% \ead[url]{home page}
%% \fntext[label2]{}
%% \cortext[cor1]{}
%% \address{Address\fnref{label3}}
%% \fntext[label3]{}

\title{$ASAP$-V: A Privacy-preserving Authentication and Sybil detection Protocol for VANETs}


%\author[label1]{Thiago de Sales\corref{cor1}} 
%\ead{thiago.sales@ee.ufcg.edu.br} 
%\address[label1]{% 
%Aprigio Veloso Street, nº 882\\ 
%Electrical Engineering and Informatics Center (CEEI)\\ 
%Federal University of Campina Grande (UFCG)\\ 
%58429 900 Campina Grande, PB, Brazil\\ 
%Tel: +55-82-3091-5397\\ 
%} 
%\cortext[cor1]{Corresponding Author} 
% 
%\author[label2]{Angelo Perkusich} 
%\ead{hani@cefala.org} 
%\address[label2]{CEFALA--CPDE--UFMG} 
% 
%\author[label1]{Anna Helena Reali Costa\fnref{money}} 
%\ead{anna.reali@poli.usp.br} 


%
% \author{Thiago M. de Sales\corref{cor1}\fnref{label2}, Angelo Perkusich\fnref{label2}}
% \ead{thiagobruno@embedded.ufcg.edu.br}
% \ead[url]{home page}
% \fntext[label2]{Electrical Engineering and Informatics Center, Federal University of Campina Grande, UFCG, Brazil.}
% \cortext[cor1]{thiago.sales@ee.ufcg.edu.br}
% \address{Addressss\fnref{label3}}
% \fntext[label3]{Intuit, Inc. USA.}



\author[label1]{Thiago Melo de Sales\corref{cor1}}
\ead{thiago.sales@ee.ufcg.edu.br}
\author[label1]{Angelo Perkusich}
\ead{perkusich@dee.ufcg.edu.br}
\author[label1]{Leandro Melo de Sales}
\ead{leandro@embedded.ufcg.edu.br}
\author[label1]{Hyggo Oliveira de  Almeida}
\ead{hyggo@dsc.ufcg.edu.br}
\author[label1]{Gustavo Soares}
\ead{gsoares@computacao.ufcg.edu.br}
\address[label1]{Embedded Systems and Pervasive Computing Laboratory, Federal University of Campina Grande, Campina Grande, PB, Brazil}

\author[label2]{Marcello de Sales}
\ead{Marcello\_deSales@intuit.com}
\address[label2]{Intuit, Inc. San Diego, C.A, USA}
\cortext[cor1]{Corresponding author}


%% use optional labels to link authors explicitly to addresses:
% \author[label1,label2]{Thiago de Sales\corref{cor1}}
% \author[label1]{Angelo Perkusich}
% \author[label1]{Hyggo Almeida}
% \author[label1, label2]{Leandro de Sales}
% \author[label1]{Gustavo Soares}
% \author[label3]{Marcello de Sales}
%\address[label1]{Electrical Engineering and Informatics Center, Federal University of Campina Grande, UFCG, Brazil.}
%\address[label2]{Computer Science Department, Federal University of Alagoas, UFAL, Brazil.}
%\address[label3]{Intuit, Inc. USA.}
%\cortext[cor1]{thiago.sales@ee.ufcg.edu.br}

%\author{Thiago de Sales, Angelo Perkusich}
%
%\address{label1}{Federal University of Campina Grande, Brazil}
%\address{label2}{Federal University of Alagoas, Brazil}

\begin{abstract}
Security plays a key role in providing reliability in Vehicular Ad Hoc Networks (VANETs), which may include node authentication and non-repudiation. Moreover, users' privacy is also a key challenge and one of the main security threats in VANETs. On the other hand, there is a trade-off between authentication/non-repudiation and users' privacy, which may lead to a harmful type of network attack called \textit{sybil} attack. In such an attack, a malicious node behaves as if it is a large number of nodes. Therefore, it may decrease service reliability and significantly impact network performance. Thus, the challenge is to provide node authentication and detect \textit{sybil} attacks without compromising users' privacy. In this paper we propose a privacy-preserving authentication and \textit{sybil} attack detection protocol for VANETs called \protocolname. Our approach uses the group signature and the multiple-pseudonym schemes to allow authentication and non-repudiation, as well as the anonymity set concept to detect \textit{sybil} attacks without compromising users' privacy. What is more, \protocolname~does not require a fixed infrastructure during \textit{sybil} attack detection time. Experimental results suggest that \protocolname~is more robust against \textit{sybil} attacks with lower average detection time, as well as lower false-positive rates and false-negative resilience compared to the state-of-art works.
\end{abstract}

\begin{keyword}

VANET \sep Security \sep Authentication \sep Privacy \sep Sybil Attack
%% keywords here, in the form: keyword \sep keyword
% - provide a maximum of 6 keywords, using American spelling and avoiding general and plural terms and multiple concepts (avoid, for example, 'and', 'of'). Be sparing with abbreviations: only abbreviations firmly established in the field may be eligible. These keywords will be used for indexing purposes.

%- Table footnotes
%- Indicate each footnote in a table with a superscript lowercase letter

%- TIFF (or JPEG): Color or grayscale photographs (halftones), keep to a minimum of 300 dpi.
%TIFF (or JPEG): Bitmapped (pure black & white pixels) line drawings, keep to a minimum of 1000 dpi.
%TIFF (or JPEG): Combinations bitmapped line/half-tone (color or grayscale), keep to a minimum of
%500 dpi.

%- Please make sure that artwork files are in an acceptable format (TIFF (or JPEG), EPS (or PDF), or
%MS Office files) and with the correct resolution. If, together with your accepted article, you submit
%usable color figures then Elsevier will ensure, at no additional charge, that these figures will appear in
%color on the Web (e.g., ScienceDirect and other sites) regardless of whether or not these illustrations
%are reproduced in color in the printed version. For color reproduction in print, you will receive
%information regarding the costs from Elsevier after receipt of your accepted article. Please
%indicate your preference for color: in print or on the Web only. For further information on the
%preparation of electronic artwork, please see http://www.elsevier.com/artworkinstructions.

%- Tables
%Number tables consecutively in accordance with their appearance in the text. Place footnotes to tables
%below the table body and indicate them with superscript lowercase letters. Avoid vertical rules. Be
%sparing in the use of tables and ensure that the data presented in tables do not duplicate results
%described elsewhere in the article.

%- Reference linking: Use of the DOI is encouraged.

%- REVER O Reference Style

%- REVER O Submission checklist quando for submeter

%% PACS codes here, in the form: \PACS code \sep code

%% MSC codes here, in the form: \MSC code \sep code
%% or \MSC[2008] code \sep code (2000 is the default)

%- Present simple formulae in the line of normal text where possible and use the solidus (/) instead of a horizontal line for small fractional terms, e.g., X/Y. In principle, variables are to be presented in italics.


\end{keyword}

\end{frontmatter}

\section{Introduction}

The Vehicular Ad Hoc Network (henceforth VANET) is an emerging type of Mobile Ad Hoc Network (MANET) that aims at providing vehicular safety applications, optimized vehicular traffic routing, and real-time applications for drivers and passengers, such as mobile infotainment~\cite{al2013comprehensive}. Vehicles act as mobile nodes\footnote{We use the terms vehicles, nodes and cars interchangeably.} that can send message to other vehicles and to roadside units (RSUs), which are fixed infrastructures along the roads that may provide vehicle connectivity in sparse or low density areas. The communication between vehicles is called V2V (Vehicle-to-Vehicle), while the communication between vehicle and RSU is called V2I (Vehicle-to-Infrastructure).

In VANET, vehicles communicate by means of the North American Dedicated Short-Range Communication (DSRC) standard, that employs the IEEE 802.11p~\cite{ieee11802} standard for wireless communication. Moreover, vehicles may send two types of messages: periodic (or beacon), and event-driven messages. The former allows a vehicle to announce its current position, speed, and direction to neighbors, allowing other vehicles to perceive and predict the kinematics of the vehicle. The latter may inform sporadic events, such as road hazardous warnings (on-road obstacles, icy surfaces, weather conditions, to name a few).	

The concepts behind VANET are bringing new challenges to a diverse of network research areas, including security~\cite{gillani2013survey}. Security has been considered a critical concern due to VANET's open wireless nature since there are no authentication and association procedures in 802.11p~\cite{ieee11802}. Thus, VANET requires fundamental security aspects in the application layer such as the vehicles' message authentication and non-repudiation. In this context, there have been a lot of new authentication approaches~\cite{riley2011survey} for VANET, which basically may include the two common cryptography key models, such as symmetric and/or asymmetric keys though Public Key Infrastructure (PKI)~\cite{keys-distro1}, \cite{keys-distro2-thesis}, \cite{MolinaGil2014172}, and \cite{keys-distro8}, as well as the group~\cite{lin2007gsis} and identity-based signature schemes \cite{authentication-id-based1}.

However authentication and non-repudiation require a one-to-one correspondence between vehicle and identity (here represented as cryptography keys), which may allow a malicious entity to build a vehicle routing profile. This may potentially compromise users' privacy and lead to several user safety problems such as kidnapping, and undesirable tracking for mobile advertisement~\cite{mix-zone-vanets}.

In order to secure users' location privacy, there are essentially three types of identity distribution: \textit{i)} all vehicles share the same identity (same key); \textit{ii)} each vehicle keeps multiple identities and certain groups of vehicles share a set of identities; and \textit{iii)} each vehicle stores multiple identities (also called multiple \textit{pseudonyms}), without sharing any identity, which are unique to each vehicle. Through a simple and secure, yet powerful mathematical and logical analysis, researchers identified that the more suitable identity assignment was the last one~\cite{haas2010impact}, which leads to a reasonable users' privacy and fast, yet secure revocation of cryptography keys.

Initially proposed by Raya et. al.\cite{keys-distro1}, there have been many other multiple-pseudonym-based approaches for securing location privacy in VANET~\cite{keys-distro2-thesis}, \cite{keys-distro8}, \cite{calandriello2007efficient} and  \cite{sun2010efficient}. Furthermore, many researchers adopt the concept of Mix Zones~\cite{mix-zone} to prevent malicious entities from linking different vehicle's pseudonyms~\cite{lu2012pseudonym}, \cite{mix-zone-vanets}, \cite{buttyan2007effectiveness}, \cite{caravan}, \cite{buttyan2009slow} and \cite{mix-zone-motion}. In this case, the main goal is to spatially and temporally build groups of vehicles in order to allow them to change their pseudonyms without compromising users' privacy.

Even so, the multiple-pseudonym approach leads to a simple, but harmful type of network attack called a \textit{sybil} attack~\cite{sybil}. In \textit{sybil} attacks, a malicious node behaves as if it is a large number of nodes. Since a vehicle may have multiple valid identities to control its privacy, a malicious vehicle can send multiple messages with different identities to inform false events in VANETs. Some examples may include false on-road obstacles and false emergency braking warning along a road, or creating an illusion of traffic congestion through beacon messages by claiming to be at different locations. The presence of a \textit{sybil} node may also increase packet loss, as well as decrease the packet delivery ratio and the aggregated throughput due to incorrect routing paths~\cite{sybil-impact3}, \cite{sybil-impact2} and \cite{sybil-attack-impact-routing1}. When a vehicle is not a \textit{sybil} node, it is called \textit{legitimate vehicle}.

Figure~\ref{fig:sybilscenario1} illustrates a \textit{sybil} attack scenario that may defeat routing algorithms. Suppose that vehicles A and D need to send messages to each other, but their wireless signal strength are not enough to reach each other. Therefore, they need to send each message to nearby vehicles through geographical-based routing algorithms, such as GPSR (\textit{Greedy Perimeter Stateless Routing})~\cite{greedy-routing, routing6} and MDDV (\textit{Mobility-centric Data Dissemination Algorithm for Vehicular Networks})~\cite{routing8}. Also suppose that vehicle E is a \textit{sybil} node that also sends beacon messages with two other different locations with identities E' and E''. Thus, vehicles A and D will send messages to E'  ($A \rightarrow E' \rightarrow D$) and E'' ($D \rightarrow E'' \rightarrow A$), respectively. Therefore, vehicle E will receive the messages and may change their contents, or simply drop them. 


\begin{figure}[ht]
\centering
\includegraphics[width=5.5in]{figures/cenario-sybil-5-en.png}
\caption{Scenario 1: \textit{sybil} attacks through beacon messages. Sybil vehicle E drops all messages from vehicles A and D.}
\label{fig:sybilscenario1}
\end{figure}


Figure~\ref{fig:sybilscenario2} depicts two other \textit{sybil} attack scenarios. A malicious vehicle E sends false event-driven messages, such as \textit{Electronic Emergency Brake Light} (EEBL) and \textit{Road Hazard Condition Notification} (RHCN). The former, the vehicle announces an emergency brake event on Lane 1 through \textit{n} messages that contain \textit{n} different identities, and in the second case, it sends \textit{n} messages with \textit{n} different identities that notify a road hazard condition on Lane 2. Therefore, in \textit{vehicle platooning}~\cite{platoon1} situations, it may cause accidents.

\begin{figure}[ht]
\centering
\includegraphics[width=5.5in]{figures/cenario-sybil-4-en.png}
\caption{Scenario 2: \textit{sybil} attacks through event-driven messages.
Sybil vehicle E explores event-driven messages to launch \textit{sybil} attacks, which can cause accidents in some situations.}
\label{fig:sybilscenario2}
\end{figure}

To avoid a vehicle from keeping, at the same time, multiple identities in multiple-pseudonym-based approaches, other works propose a single vehicle to store only one identity at a time~\cite{keys-distro4}, \cite{keys-distro5}, \cite{keys-distro55}, \cite{keys-distro7} and \cite{profile-generation1}. To change its identity, each vehicle requests from the RSUs along the road, one new identity that is valid only in the region where the RSU is responsible for. These approaches lack flexibility and they are highly dependable on the RSUs deployment methods~\cite{rsu-placement1}. Other approaches explore the RSU and Certificate Authority (CA) to detect \textit{sybil} attacks~\cite{p2dap2} and \cite{p2dap}, as well as the relationship between time and space~\cite{sybil-time-space1}, \cite{sybil-time-space2} and \cite{sybil-time-stamp1} and the use of neighboring vehicles to filter malicious vehicles~\cite{sybil-neighborhood1} and \cite{sybil-neighborhood3}. Nonetheless, due to the tradeoff between \textit{sybil} detection attacks and privacy-preserving authentication, these approaches suffer from \textit{false-negative} \textit{sybil} attack detections when a malicious vehicle is not detected as one. 

Based on a deep investigation of the state of the art approach, this paper proposes a decentralized privacy-preserving authentication and \textit{sybil} attack detection protocol for VANETs called~\protocolname~(\textit{Authentication and Sybil Attack detection Protocol for VANETs}). The authentication process is based on the multiple-pseudonym approach in order to provide location privacy for the users. Non-repudiation is also achieved through the Group Signature Scheme~\cite{group-sign}. Moreover, our approach uses the anonymity set theory~\cite{k-anonymity} in a multilevel fashion to detect and avoid \textit{sybil} attacks, while still providing users' privacy control. The proposed solution does not require a fixed infrastructure during the \textit{sybil} attack detection time, nor does it require third-party services such as trust and reputation systems~\cite{trust}. Instead, the \textit{sybil} detection is coordinated through the vehicles in the vicinity. We evaluated our approach using the BAN logic~\cite{burrows1989logic} formal method, which proves that our multiple-pseudonym authentication approach is secure, and the \textit{sybil} detection protocol through simulated experiments.

The contributions of this paper are summarized as follows:

\begin{itemize}
	\item a new privacy-preserving authentication and \textit{sybil} detection protocol;
	\item decentralization of the \textit{sybil} detection approach, which does not require a fixed infrastructure during detection time;
	\item a resilient approach to false-negative \textit{sybil} detection results without the support of an infrastructure. Hence, our \textit{sybil} detection approach will always detect a malicious vehicle without compromising other's user privacy;
	\item it is able to detect \textit{sybil} attacks from both beacon and event-driven messages;
	\item finally, our results suggest that the detection protocol provides lower average \textit{sybil} attack detection time than the state-of-the-art approaches. 
\end{itemize}

The remainder of the paper is organized as follows: Section~\ref{sec:solution} details the proposed privacy-preserving authentication and \textit{sybil} detection approach. Section~\ref{sec:results} discusses the experiments and results of the approach, while Section~\ref{sec:related} briefly discusses the related works in the context of privacy-preserving \textit{sybil} detection attacks. Finally, Section~\ref{sec:conclusion} presents the conclusions and future work.

\section{A Privacy-preserving Authentication and Sybil Attack Detection Protocol for VANET}
\label{sec:solution}

This section details the privacy-preserving authentication and \textit{sybil} detection protocol for VANETs called \protocolname. The goal is to provide strong privacy-preserving authentication and non-repudiation while detecting \textit{sybil} attacks. 

\subsection{The Threat Model}

Before detailing the main features of the \protocolname~protocol, it is important to point out which types of malicious users we are dealing with. Thus, it is possible to understand the main threats that they may launch in order to compromise the available services of a VANET. This information also helps us to understand what the malicious users' profiles are, how they operate during a given attack, and what their advantages and limitations are during such attack. Hence, it is possible to define and to build more reliable solutions to detect and avoid attacks.

In our case, there are two main threats to cope with: the \textit{sybil} attack, and the potential violation of the driver's privacy. According to the Raya taxonomy~\cite{keys-distro1}, the former threat may be launched from malicious users classified as \textit{insider} (users with authenticated vehicle), \textit{malicious} or \textit{rational} (users that aim to harm or just to seek personal profit, respectively), \textit{active} (users that can generate authenticated packets), and \textit{local} (users that are limited in scope). On the other hand, the latter threat may be launched from a malicious entity classified as an \textit{insider} or \textit{outsider} (an intruder), \textit{rational}, \textit{passive} (users that only eavesdrop on the wireless channel), and \textit{extended} (users that control several sensors that are scattered across the network).

\subsection{The \protocolname~protocol description}

The \protocolname~uses the concepts of pseudonyms and the anonymity set theory for protecting users' privacy, as well as the group signature scheme for providing non-repudiation. To detect \textit{sybil} attacks while preserving users' privacy, the \protocolname~divides the vehicles into multiple anonymity sets organized in a multilevel architecture. This way, each vehicle shares a set of attributes with other vehicles, but it must have at least one attribute that differs from other vehicles in a given period of time.

The \protocolname~protocol is divided into four phases: the registration phase (Phase 1), the temporary identity (pseudonym) assignment phase (Phase 2), the \textit{sybil} detection phase (Phase 3), and the prosecution phase (Phase 4). The next sections describe each phase, while Table~\ref{tab:nomenclature} summarizes the notations for the protocol description.

\tablefirsthead{%
\hline
\multicolumn{1}{p{2cm}}{Symbol} &
\multicolumn{1}{p{11.5cm}}{Description} \\
\hline}
\tablehead{%
\hline
\multicolumn{2}{l}{\small\sl continued from previous page}\\
\hline
\multicolumn{1}{p{2cm}}{Symbol} &
\multicolumn{1}{p{10cm}}{Description} \\
\hline}
\tabletail{%
\hline
\multicolumn{2}{r}{\small\sl continued on next page}\\
\hline}
\tablelasttail{\hline}
\topcaption{Notations.}

\begin{supertabular}{l@{\hspace{3mm}}l@{\hspace{2mm}}}
\label{tab:nomenclature}
$v_{c}$ & Vehicle \textit{c}. \\ 
$RSU_{n}$ & The $n^{th}$ RSU along the road. \\
$cert_{a}$ & Digital certificate of an entity \textit{a}. \\ 
$k^{+}_{a, n}$ & The \textit{a}'s $n^{th}$ public key. \\
$k^{-}_{a, n}$ & The \textit{a}'s $n^{th}$ private key. \\
$cert_{a, n}$ & The \textit{a}'s $n^{th}$ public key digital certificate.\\  
$TK_{a}$ & \textit{a}'s set of temporary public/private key pairs (pseudonyms).\\
$gsk_{c}$ & Group signing key of vehicle \textit{c}.\\ 
$gpk$ & A group public key.\\
$grt_{c}$ & Group revocation token of vehicle \textit{c}.\\ 
$RL$ & List of revoked \textit{group revocation tokens}.\\
$tmp$ & Current timestamp. \\ 
$tmp_{ctn}$ & The timestamp that the content \textit{ctn} was digitally signed. \\ 
$threshold_{X}$ & \pbox{20cm}{Denotes the maximum (X = \textit{max}) or minimum (X = \textit{min}) \\ timestamp value to define time intervals \textit{t}.} \\ 
$Sign(\bullet)$ & A digital signature function. \\
$Signed^{m_a}_{a}$ & Entity \textit{a} signed message $m_a$. \\
$a \Rightarrow b: m_a$ & Entity \textit{a} sends message $m_a$ to \textit{b}.
 \\
$E(\bullet)$ & An encryption function. \\ 
$D(\bullet)$ & A decryption function. \\ 
$sybil_{v_{c}}$ & Vehicle $v_{c}$ is a \textit{sybil} node \\ 
\end{supertabular}

\subsection{Vehicle Registration and Authentication (Phase 1)}
\label{sec:phase1}
Figure~\ref{fig:vehicle-registration} depicts the registration phase. A CA is responsible for managing the unique vehicles' identities by using the Group Signature Scheme~\cite{group-sign}. A vehicle $v_{c}$  has its own group signing key ($gsk_{c}$) and also shares the group public key (\textit{gpk}) with others. Vehicles also store the digital certificate of the CA ($cert_{CA}$) and the digital certificate of the Road Side Units ($cert_{RSU}$). Moreover, each vehicle receives a set $TK_{c}$ of \textit{w} temporary (identities, or pseudonyms) asymmetric key pairs and their digital certificates ($k^{+}_{c,i}$, $k^{-}_{c,i}$, $cert_{c,i}$, $1 \le i \le w$). In case of judicial disputes, the CA is the only entity that can trace the original vehicle identity from a given message $m_{c}$ using its group manager secret key (\textit{gmsk}).

%Figure~\ref{fig:vehicle-registration} summarizes the process of vehicle registration and authentication as the first step of the execution of the \protocolname~protocol. A CA is responsible for managing the unique identities of the vehicles by using the group signature scheme. Each vehicle has its own group sign key ($gsk_{c}$) and also shares the group public key (\textit{gpk}) with others. Vehicles also store the digital certificate of the CA ($cert_{CA}$) and the digital certificate of the roadside units ($cert_{RSU}$). Moreover, each vehicle receives one temporary (pseudonym) asymmetric key pair and its certificate ($k^{+}_{c,1}$, $k^{-}_{c,1}$, $cert_{c,1}$). In case of judicial disputes, the CA is the only entity that can trace the original vehicle identity from a given message using its group manager secret key (\textit{gmsk}).

\begin{figure}[ht]
\centering
\includegraphics[width=5.5in]{figures/registro-veiculo-en.jpg}
\caption{Vehicle registration and authentication.}
\label{fig:vehicle-registration}
\end{figure}

The second step of the registration phase aims to cluster each vehicle into multiple sets of vehicles $AS_{i,j}$ ($i, j \in \mathbb{N}^{*}; 1 \le i \le m, 1 \le j \le n$). Each set $AS_{i,j}$  has all of the properties of the anonymity set theory. According to Figure~\ref{fig:multilevel-arch}, the anonymity sets $AS_{m,n}$ are organized in \textit{m} levels, where each level has \textit{n} anonymity sets. The proposed multilevel anonymity set architecture has the following properties, which from 1 to 3 aim at protecting users privacy, while property 4 aims at detecting \textit{sybil} attacks:

\begin{enumerate}
	\item Let $V = \{v_{1}, v_{2} ... v_{p}\}$ the set of all vehicles registered. $p = |V|$ is the total number of vehicles and K-AS = \{$AS_{1,1}$, $AS_{1,2}$, ..., $AS_{1,n}$, ...,  $AS_{2,1}$, $AS_{2,2}$, ..., $AS_{2,n}$, ..., $AS_{m,n}$\} is the set of all anonymity sets;
	
	\item Each vehicle must belong to at least \textit{k} sets ($1\textless k \textless n$) in each level. $AS_{c}$ denotes the set of all anonymity sets that vehicle $v_{c}$ belongs to ($AS_{c} \subseteq K \mhyphen AS$). For instance, $AS_{c} = \{AS_{1,1}, AS_{1,3}, AS_{1,12}, AS_{1,22}, AS_{1,35}, AS_{2,5},$ $AS_{2,9}, ..., AS_{m,n}\}$ if it belongs to anonymity sets $AS_{1,1}, AS_{1,3}$ etc.;
\item Each anonymity set $AS_{i,j}$ has a digital certificate $cert_{AS_{i,j}}$ signed by CA, that is, $Signed^{cert_{AS_{i,j}}}_{CA}$. Thus, if vehicle $v_{c}$ belongs to $AS_{i,j}$, then $v_{c}$ must store $cert_{AS_{i,j}}$. Formally, $v_{c} \in AS_{i,j} \rightarrow cert_{AS_{i,j}} \in$ $CERT_{AS_{c}}$, such that:
	
	\begin{enumerate}
		\item $CERT_{AS_{c}}$ is the set of all anonymity sets' digital certificates in which the vehicle $v_{c}$ belongs to; and,
	
		\item for a given time interval \textit{t}, a vehicle $v_{c}$ must choose a subset $CERT^{t}_{AS_{c}}$ of anonymity set digital certificates ($CERT^{t}_{AS_{c}} \subseteq CERT_{AS_{c}}$) that comprises only one digital certificate per level.
	\end{enumerate}
	
	\item Any two vehicles $v_{c}$ and $v_{c'}$ in $AS_{1,j}$ must not belong to the same anonymity set of some lower level. Formally\footnote{The symbol $\oplus$ represents an exclusive-or operator.}, $\forall v_{c}, v_{c'} \in AS_{1, j},$  $\exists$ $i$ $(\forall$ $r$ $(v_{c} \in AS_{i,r} \oplus v_{c'} \in AS_{i,r} )) $ $ \{i, j, r \in \mathbb{N} : 1 < i \le m, 1 \le j \le n, 1 \le r \le n\}$. Therefore, $CERT^{t}_{AS_{c}} - CERT^{t}_{AS_{c'}} \neq \emptyset$. 
\end{enumerate}

\begin{figure}[ht]
\centering
\includegraphics[width=5.5in, height=2in]{figures/vehicle-groups2-en.jpg}
\caption{The Multilevel \protocolname~Architecture.}
\label{fig:multilevel-arch}
\end{figure}


\subsection{Temporary Key Assignment (Phase 2)}
\label{sec:phase2}

In order to protect users' privacy, the multiple-pseudonym-based approach is used, and the second phase is responsible for managing pseudonym assignments to vehicles. In the \protocolname~protocol, cryptography asymmetric key pairs represent vehicle pseudonyms. For instance, the key pair $k^{+}_{c, i}/k^{-}_{c, i}$ and its certificate $cert_{c,i}$ is the $i^{th}$ pseudonym of the vehicle $v_{c}$. Vehicles obtain temporary keys from authenticated RSUs available along the roads. Listing~\ref{renewprotocol} shows the temporary key assignment protocol, which is detailed as follows: 

%\begin{lstlisting}[caption=Pseudonym renewal protocol., label=renewprotocol, mathescape]
%Step (1): $v_{c} \Rightarrow RSU_{n}$: $\sigma = $ Sign($gpk, gsk_{c}, m$),  $cert_{c, i}$, $cert_{c, TPD}$
%Step (2): $RSU_{n}$: 
%Step (2.1): Verify($gpk, \sigma, m$)
%Step (2.2): Generates the set $TK_{c}$ of w temporary key pairs
%and authenticates (signs) each key pair
%Step (3): $RSU_{n} \Rightarrow v_{c}$: $E(k^{+}_{c,i}, TK_{c}, cert_{c, TPD})$
%\end{lstlisting}

\begin{lstlisting}[caption=Pseudonym renewal protocol., label=renewprotocol, mathescape]
Step (1): Vehicle $v_{c}$: 
Step (1.1): $payload_c = cert_{c,i} || UUID_c$, $\sigma =  Sign(gpk, gsk_{c}, payload_c)$ 
Step (1.2): $m_{c} = E(k^{+}_{RSU}, \sigma)$ 
Step (1.3): $v_{c} \Rightarrow RSU: m_{c}$
Step (2): $RSU$:
Step (2.1): $m_{c} = D(k^{-}_{RSU}, m_{c})$
Step (2.2): Verify($gpk, \sigma, payload_c$)
Step (2.3): Generates the set $TK_{c}$ of w temporary key pairs and 
authenticates (signs) each key pair
Step (2.4): $RSU \Rightarrow v_{c}$: $E(k^{+}_{c,i}, TK_{c} || UUID_c)$
\end{lstlisting}


\begin{itemize}
	\item In Step 1, a vehicle $v_{c}$ requests the set of temporary keys from a given $RSU$. In Step 1.1, the vehicle $v_{c}$, using the group signature schema, signs its $i^{th}$ temporary digital certificate ($cert_{c,i}$) and a UUID (\textit{random Universely Unique IDentifier}) value, which generates the group signature $\sigma$. The \textit{UUID} is a 128-bit identifier value and, within the context of ASAP-V protocol, it aims at preventing \textit{man-in-the-middle} attacks, as it will be discussed in Section~\ref{sec:authenticationCorrectness}. In Step 1.2 the vehicle $v_{c}$ encrypts the signature $\sigma$ using $RSU$'s public key, which generates the request message $m_c$. Finally, in Step 1.3, the $v_{c}$ sends the request message to the $RSU$;
		
	\item  In Step 2, the $RSU$ checks two parameters: first, it decrypts the received message $m_c$ in Step 2.1 by using its private key $k^{-}_{RSU}$. In Step 2.2, it verifies if the group revocation token ($grt_{c}$) of vehicle $v_{c}$ is not in the Revocation List (RL) and if the message's timestamp (the time that $v_{c}$ sent $m_c$) is within a reasonable threshold in order to avoid replay attacks~\cite{replay-attack}. The \textit{Verify} function represents this process and is formally described in the Equation~\ref{eq:etapa21}. The CA is responsible for periodically sharing an updated version of RL, which is detailed in Section~\ref{sec:phase4}.

	\begin{equation} 
	\label{eq:etapa21}
		Verify(gpk, \sigma, payload_{c}) = valid \leftrightarrow grt_{c} \notin RL \wedge (\textit{tmp} - tmp_{m_{c}} \le threshold_{max})
	\end{equation}			
	
	If valid, in Step 2.3 the $RSU$ generates the new set of keys $TK_{c} = \{ (k^{+}_{c,1}/k^{-}_{c,1}), (k^{+}_{c,2}/k^{-}_{c,2}), (k^{+}_{c,3}/k^{-}_{c,3})..., (k^{+}_{c,w}/k^{-}_{c,w})\}$ for vehicle $v_{c}$ and authenticates each key:
	
	\begin{equation}
\label{eq:etapa22}
	\forall k^{+}_{c,i} \in TK_{c} (1 \le i \le w), Sign(k^{-}_{RSU}, k^{+}_{c,i}) = cert_{c,i}.
\end{equation}

	\item In Step 2.4, the $RSU$ returns the new set of temporary keys to the vehicle $v_{c}$ by encrypting the message with the $i^{th}$ $v_{c}$'s temporary public key received in Step 1 ($k^{+}_{c,i}$ is extracted from $cert_{c,i}$), and the $v_{c}$'s $UUID_c$ value. Each key pair and its digital certificate represent a $v_{c}$'s temporary identity, also called pseudonym.
	
\end{itemize}

Vehicles must store all anonymity set digital certificates and temporary keys in a tamper-resistant Hardware Security Module (HSM), also known as tamper-proof device (TPD - see Figure~\ref{fig:tamper-proof}). This avoids malicious users from copying keying material that belongs to other vehicles. A TPD is also responsible for signing messages on behalf of the vehicle's applications, as well as to check message authenticity received from other vehicles and to manage the change of pseudonyms. It is important to point out that IEEE 1609.2, which describes all security aspects of the Wireless Access for Vehicular Environment (WAVE) architecture, also emphasizes that whenever practical, keying material must be protected from exposure in a TPD. Therefore, the availability of such device is an essential component to provide security services in VANETs.

\begin{figure}[ht]
\centering
\includegraphics[scale=.55]{figures/tamper-proof-and-applications.jpg}
\caption{A tamper-proof device (TPD), which goes inside of a vehicle, stores key materials, while applications request message digital signatures, digital signature authenticity checking and decryption, as well as pseudonym management.}
\label{fig:tamper-proof}
\end{figure}

From now on, a legitimate vehicle $v_{c}$ may send messages to the network. Figure~\ref{fig:msg-format} depicts the message format and its field goals. Each message is digitally signed with the $i^{th}$ $v_{c}$'s temporary private key ($k^{-}_{c,i}$), which aims at providing message authenticity and integrity; the \textit{event} field is the message's event type (e.g., beacon, accident warning etc.); $cert_{AS_{1,j}}$ is the (current) first level anonymity set digital certificate ($cert_{AS{1,j}} \in CERT^{t}_{AS_{c}}$) that the vehicle $v_{c}$ belongs to (this field allows one or more anonymity set digital certificates, as discussed in Section~\ref{sec:sybildetec}); $\sigma$ is the group signature of data \textit{d}, which allows privacy-preserving non-repudiation; $cert_{c, i}$ is the $i^{th}$ $v_{c}$'s public key digital certificate that also allows other vehicles to evaluate the correctness of the message's digital signature; and \textit{timestamp} is the time in which the vehicle $v_{c}$ signs the message, which aims to detect replay attacks.

\begin{figure}[ht]
\centering
\includegraphics[scale=.53]{figures/message-format.jpg}
\caption{The format of beacon or event-driven messages and the field goals.}
\label{fig:msg-format}
\end{figure} 

The multiple-pseudonym approach proposed herein may use any of the pseudonym change approaches available in the literature~\cite{lu2012pseudonym}, \cite{mix-zone-vanets}, \cite{buttyan2007effectiveness}, \cite{caravan}, \cite{buttyan2009slow} and \cite{mix-zone-motion}. However, the change of pseudonyms may imply a change on the current anonymity set digital certificates $CERT^{t}_{AS_{c}}$ that the vehicle $v_{c}$ must use. For instance, suppose that $v_{c}$ belongs to the following anonymity sets of 5 levels ($m = 5$): $AS_{c} = \{AS_{1,1}, AS_{1,3}, AS_{1,12}, AS_{1,22}, AS_{1,35}, AS_{2,5}, AS_{2,9}, AS_{2,18}, \newline AS_{2,23}, AS_{3,6}, AS_{3,15}, AS_{3,21}, AS_{4,9}, AS_{4,27}, AS_{4,32}, AS_{5,2}, AS_{5,11}, AS_{5,23}, AS_{5,43}\}$. If $v_{c}$ is currently sending messages with pseudonym $cert_{c, 3} \in TK_{c}$  and its current anonymity set digital certificates is $CERT^{t_{1}}_{AS_{c}} = \{cert_{AS_{1, 3}}$, $cert_{AS_{2, 18}}$, $cert_{AS_{3, 6}}$, $cert_{AS_{4, 32}}$, $cert_{AS_{5, 23}}\}$, then the change from the pseudonym $cert_{c, 3}$ to $cert_{c, 4} \in TK_{c}$ requires a new subset $CERT^{t_{2}}_{AS_{c}}$ of anonymity set digital certificates. This approach aims to avoid pseudonym linkage, in which an eavesdropper is able to associate two or more pseudonyms that belong to the same vehicle in different time intervals. 

For instance, suppose that two vehicles  $v_{A}$ and $v_{B}$ belong to the first level anonymity sets $AS_{1,2}$ and $AS_{1,3}$, respectively. Hence, their messages must include at least the digital certificates $cert_{AS_{1, 2}} \in CERT^{t1}_{AS_{A}}$ and $cert_{AS_{1, 3}} \in  CERT^{t1}_{AS_{B}}$, respectively. Now consider the following scenario depicted in Figure~\ref{fig:pseudonymchangeslink}: both vehicles form a mix zone and start a pseudonym change process at time $t_{1}$. If vehicle $v_{A}$ changes the pseudonym $cert_{A,1} \in TK_{A}$ to $cert_{A, 2} \in TK_{A}$, $v_{B}$ changes from $cert_{B, 1}  \in TK_{B}$ to $cert_{B, 2}  \in TK_{B}$, but they also keep their current anonymity set digital certificates as $cert_{AS_{1, 2}}$ and $cert_{AS_{1, 3}}$ at time $t_{2}$ (i.e.: $CERT^{t2}_{AS_{A}} = CERT^{t1}_{AS_{A}}$ and $CERT^{t2}_{AS_{B}} = CERT^{t1}_{AS_{B}}$), then an eavesdropper may link both changes by analyzing the first level anonymity set digital certificates (i.e.: $cert_{AS_{1, 2}}$ and $cert_{AS_{1, 3}}$). On the other hand, if both vehicles also change their current anonymity set digital certificates at time $t_{2}$ ($CERT^{t1}_{AS_{A}} \neq CERT^{t2}_{AS_{A}}$ and $CERT^{t1}_{AS_{B}} \neq CERT^{t2}_{AS_{B}}$), then it is difficult to link new and previous pseudonyms.

\begin{figure}[ht]
\centering
\includegraphics[scale=.53]{figures/cenario-mudanca-pseud-1-en.jpg}
\caption{An eavesdropper may link old and new pseudonyms if vehicles do not change their current anonymity set digital certificates during the change of pseudonyms.}
\label{fig:pseudonymchangeslink}
\end{figure} 

The TPD will not change the current subset from $CERT^{t}_{AS_{c}}$ to $CERT^{t+1}_{AS_{c}}$ if the last change occurred in a time less than $\tau$ units of time. This decision helps to avoid \textit{sybil} attacks, which comprise the third phase of the \protocolname~protocol and is discussed on the next section.

\subsection{The \textit{Sybil} Attack Detection (Phase 3)}
\label{sec:sybildetec}

The third phase of the \protocolname~protocol is the \textit{sybil} attack detection itself. A \textit{sybil} attack may be explored from malicious users that modify their vehicles to launch the attack. 

In short, to detect a \textit{sybil} node while keeping vehicles' privacy, consider that any vehicle will send messages with a subset of anonymity set digital certificates. In a given time interval \textit{t}, a legitimate vehicle sends messages with one pseudonym that carries a subset of anonymity set digital certificates. However, \textit{sybil} nodes send messages with multiple pseudonyms (at the same time) with the same subset of anonymity set digital certificates. Therefore, if a vehicle receives messages with different pseudonyms, but with the same subset of anonymity set digital certificates, then, the receiver detected a \textit{sybil} attack. After detecting a \textit{sybil} node, the Certificate Authority may identify the malicious vehicle through the group signatures (which comprises the fourth phase of ASAP-V).

The \textit{sybil} attack is defined as follows:

\begin{definition}
\label{def:sybil-event}
In the sybil attack, a vehicle uses multiple identities to disseminate the same false event. This vehicle is so called the sybil vehicle or the sybil node.
\end{definition}

In VANETs, vehicles disseminate events in order to provide vehicular safety applications. Examples may include accident reporting, an approaching safety vehicle, and electronic emergency braking warnings, to name a few. These events are classified as sporadic events. Beacon messages, which allow vehicles to perceive and predict the kinematics of other vehicles, may also be an event and are classified as periodic events. An event is defined as follows:

\begin{definition}
\label{def:event}
An event, as defined in~\cite{p2dap2}, is represented as a tuple $\langle evt, l, t \rangle$, where \textit{evt} is the event type, \textit{l} and \textit{t} are the location and the time interval in which the event occurred, respectively.
\end{definition}

The privacy-preserving \textit{sybil} detection phase explores the multilevel anonymity set architecture (described in Section~\ref{sec:phase1}) to detect \textit{sybil} attacks from beacon and event-driven messages. In short, the properties 1 to 3 provide privacy control, while property 4 allows the \textit{sybil} detection process. The basic detection concept is as follows: any two or more messages with different pseudonyms, which disseminate the same event, cannot include the same subset of anonymity set digital certificates. Hence, during a \textit{sybil} attack, the system must evaluate the Equation~\ref{eq:sybil-detection-eq}, where $V_{l}$ is the set of vehicles in the transmission range in a given location \textit{l}.  

\begin{equation}
\label{eq:sybil-detection-eq}
\forall (v_{c}, v_{c'}) \in V_{l} (\thinspace |CERT^{t}_{AS_{c}}| = |CERT^{t}_{AS_{c'}}| \wedge CERT^{t}_{AS_{c}} - CERT^{t}_{AS_{c'}} \neq \emptyset)
\end{equation}

In beaconing-like messages, if any vehicle $v_{b}$ receives beacon messages from vehicle $v_{a}$, ($v_{a}, v_{b}) \in V_{l}$, and these messages include the same subset $CERT^{t}_{AS_{b}}$ of $v_{b}$' anonymity set digital certificates, then both vehicles gradually attach, into their beacon messages, the digital certificate of the next deeper anonymity set until the Equation~\ref{eq:sybil-detection-eq} is satisfied, where all messages are distinguishable among each other.

\begin{figure}[ht]
\centering
\includegraphics[width=5.5in, height=1in]{figures/cenario-sybil-5-en.jpg}
\caption{Sybil vehicle E sends three different beacon messages with three identities.}
\label{fig:sybil2}
\end{figure}

For instance, consider the scenario depicted in Figure~\ref{fig:sybil2}. The malicious vehicle $v_{e}$ (\textit{sybil}) and the legitimate one $v_{a}$ are, among \textit{k} anonymity sets per level, in the following anonymity sets for 5 levels ($m = 5$), respectively: $AS_{e}$ = \{$AS_{1,2}$, $AS_{2,4}$, $AS_{3,2}$, $AS_{4,6}$, $AS_{5,1}$\}, $AS_{a}$ = \{$AS_{1,2}$, $AS_{2,4}$, $AS_{3,2}$, $AS_{4,4}$, $AS_{5,2}$\}. Thus, each vehicle also stores its current anonymity set digital certificates as $CERT^{t}_{AS_{e}}$ = \{$cert_{AS_{1,2}}$, $cert_{AS_{2,4}}$, $cert_{AS_{3,2}}$, $cert_{AS_{4,6}}$, $cert_{AS_{5,1}}$\}, $CERT^{t}_{AS_{a}}$ = \{$cert_{AS_{1,2}}$,  $cert_{AS_{2,4}}$, $cert_{AS_{3,2}}$, $cert_{AS_{4,4}}$, $cert_{AS_{5,2}}$\}. Furthermore, suppose that the vehicles also store \textit{w} temporary key pairs $TK_{e}$ and $TK_{a}$.

%\begin{figure}[h]
%\centering
%\caption{Detecting \textit{sybil} attacks from beacon messages.}
%\includegraphics[scale=0.6]{figures/cenario-sybil-5-execution-en.png}
%\label{fig:sybildetectionexecution}
%\end{figure}

\begin{figure}[h]
\includegraphics[width=5.5in]{figures/cenario-sybil-5-execution-en.png}
\caption{
Detecting \textit{sybil} attacks from beacon messages. To detect a \textit{sybil} attack, messages with different pseudonyms carry the same subset of anonymity set digital certificate.}
\label{fig:sybildetectionexecution}
\end{figure}

Figure~\ref{fig:sybildetectionexecution} depicts the \textit{sybil} attack detection. The malicious vehicle $v_{e}$ fires a \textit{sybil} attack by sending 3 different beacon messages that describe 3 location points. Since beacon messages are broadcasted to all vehicles in the transmission range, the vehicle $v_{a}$ observes that other vehicle(s) is (are) transmitting messages that contain the same first level anonymity set digital certificate ($AS_{1, 2}$). Therefore, $v_{a}$ attaches the next anonymity set digital certificate (e.g.: $cert_{2,4}$) and sends it on its next beacon message. When $v_{e}$ receives $v_{a}$'s message, it must have to update to the next two levels. In this case, since $v_{e}$ knows that it also belongs to anonymity set $AS_{2, 4}$, it also must include the third anonymity set digital certificate (e.g.; $cert_{3, 2}$), otherwise vehicles in the vicinity will only drop the messages and the \textit{sybil} attack has no effect. On the other hand, the other vehicles (e.g.: $v_{b}$, $v_{c}$, $v_{d}$, $v_{f}$, $v_{g}$) only store $v_{e}$'s and $v_{a}$'s messages. After receiving $v_{e}$'s messages, $v_{a}$ attaches the fourth level anonymity set digital certificate (e.g.: $cert_{4, 4}$) and sends it all together. Finally, the malicious vehicle sends its fourth level anonymity set digital certificate (e.g.: $cert_{4,6}$). 

Note that if a malicious vehicle $v_{e}$ sends messages with multiple identities, these messages will always carry the same set of anonymity set digital certificates. That is, only messages from identities $v_{e'}$, $v_{e''}$ and $v_{e'''}$ do not satisfy Equation~\ref{eq:sybil-detection-eq}. Therefore, vehicles $v_{a}$, $v_{b}$, $v_{c}$, $v_{d}$, $v_{g}$ and $v_{f}$ store the messages from $v_{e}$ as a set of \textit{n} messages $M_{e, n}$, which is used for prosecution purpose (Phase 4, detailed in next section).

After a short time interval receiving messages with different identities, but still containing the same anonymity set digital certificates, the vehicles in the vicinity may conclude that the messages with these identities come from a \textit{sybil} node (e.g.: $v_{e}$). Equation~\ref{eq:wait-time} defines this short time interval that the vehicles $v_{a}$, $v_{b}$, $v_{c}$, $v_{d}$, $v_{g}$ and $v_{f}$ must wait for vehicle $v_{e}$ to send the next anonymity set digital certificate after receiving the last one. The time interval is evaluated for each group of messages that contain the $AS_{1, j}$'s anonymity set digital certificate. The \textit{m} variable is the maximum number of anonymity set levels, \textit{pm} is the number of anonymity set digital certificates already presented by the target vehicle, and $V_{l}$ is the number of neighboring nodes in the transmission range. Therefore, after $\delta_{AS_{1,j}}$ \textit{ms} after receiving the last anonymity set digital certificate, the vehicles $v_{a}$, $v_{b}$, $v_{c}$, $v_{d}$, $v_{g}$ and $v_{f}$ may evaluate the vehicle $v_{e}$ as a \textit{sybil} node.

\begin{equation} 
\label{eq:wait-time}
\delta_{AS_{1,j}}  = \textit{\text{beacon interval}} + (m - pm) * V_{l} / m
\end{equation}

Equation~\ref{eq:wait-time} defines a dynamic behavior in which $\delta_{AS_{1,j}}$ must be as high as the number of vehicles in the transmission range is high, but, in order to minimize the impact of the \textit{sybil} attack, $\delta_{AS_{1,j}}$ smoothly decreases as the number of presented anonymity set digital certificates per level within the beacon messages increases. A vehicle evaluates Equation~\ref{eq:wait-time} for each new beacon message that it receives and contains the anonymity set digital certificate $cert_{AS_{1, j}}$.

In order to detect \textit{sybil} attacks from event-driven messages, each vehicle $v_{i}$ must attach all current anonymity set digital certificates ($CERT^{t}_{AS_{i}}$) in the message. Suppose the vehicle $v_{a}$ reports an emergency braking alert (EBBL). Hence, the messages would be as follows:  $Sign(k^{-}_{a,1}, m)$ = $\langle $EBBL, ($\boldsymbol{cert_{AS_{1,2}}}$, $\boldsymbol{cert_{AS_{2,4}}}$, $\boldsymbol{cert_{AS_{3,2}}}$, $\boldsymbol{cert_{AS_{4,4}}}$, $\boldsymbol{cert_{AS_{5,1}}}$), $\sigma = Sign(gpk, gsk_{a}, d)$, $d = ....., cert_{a, 1} \rangle$. According to property 4 of the multilevel anonymity sets architecture, it is impossible for two different vehicles to announce the same event with the same \textit{anonymity set digital certificates}. This approach definitely avoids a \textit{sybil} attack from event-driven messages without compromising the privacy of the vehicles.

\subsection{Sybil Attack Prosecution Phase (Phase 4)}
\label{sec:phase4}

Once a misbehaved vehicle $v_{e}$ is detected, all other vehicles $v_{i}$ in \textit{l} store $v_{e}$'s messages as a set of sample \textit{n} suspected messages $M_{e, n}$. Thus, a prosecution protocol is executed as illustrated in Figure~\ref{fig:accusation}. 

In Step 1, each vehicle $v_{i}$ generates a digitally signed prosecution message and sends it to the nearby RSU. Each vehicle $v_{i}$ that detected the \textit{sybil} vehicle (e.g.: $v_{a}$ and $v_{b}$) uses it's group signing key (e.g.: $gsk_{a}$ and $gsk_{b}$) to digitally sign the prosecution message, and also attach the sample of suspected messages evaluated as \textit{sybil} messages (e.g.: $m_{e, 1}$, $m_{e, 2}$, $m_{e, 3}, ..., m_{e, n} \in M_{v_{e}, n}$). In Step 2, the RSU forwards the received prosecution messages to the CA. In Step 3, the CA extracts the suspected messages from the prosecution message and traces their owners using its \textit{gmsk} key. If all \textit{n} messages describe the same event \textit{evt} and are originated from the same vehicle $v_{e}$ (it digitally signed all messages), then the CA resolves each message to the same unique vehicle identity (i.e.: a \textit{sybil} vehicle). Equation~\ref{eq:traceall} formally describes the verification process. Finally, the CA inserts the malicious vehicle's group revocation token (e.g.: $grt_{e}$) into the revocation token list (RL), and sends the RL to all RSUs in Step 4. 

\begin{figure}[ht]
\centering
\includegraphics[scale=.5]{figures/acusacao-en.jpg}
\caption{The prosecution of misbehaved vehicles.}
\label{fig:accusation}
\end{figure}

\begin{equation} 
\label{eq:traceall}
\begin{split}
TraceAll(gmsk, M_{v_{e}, n}) = \forall m_{i}, m_{j} \in M_{v_{e},n}, (evt_{i} \in m_{i} = evt_{j} \in m_{j}) \wedge \\ 
(Signed^{\sigma_{i}}_{v_{e}} \wedge Signed^{\sigma_{j}}_{v_{e}}) \leftrightarrow sybil_{v_{e}} \{i, j, n \in \mathbb{N} : 1 \le i \le n, 1 \le j \le n, i \neq j\}
\end{split}
\end{equation}

\section{Protocol Analysis and Experimental Results}
\label{sec:results}

This section presents the experimental results of the proposed solution. First, we analyze the management, storage, computation, and communication overheads; mainly w.r.t. the cryptography key management and its processing. Afterwards, we show the correctness verification of the pseudonym renewal protocol. Finally, we present the simulation results of the proposed \textit{sybil} detection approach. 

\subsection{Management, Storage, Computation and Communication Overheads}
\label{sec:overheads}
In spite of the number of security properties involved, the following overhead analysis shows that \protocolname~is a lightweight protocol within the context of VANETs.

\begin{itemize}
	\item \textit{Management overhead}: the CA is only responsible for managing the anonymity set digital certificates and the group signing keys, which do not change frequently. In addition, vehicles must only manage the pseudonyms renewal that requires minimal changes;

	\item \textit{Storage overhead}: the CA stores the anonymity set digital certificates, which takes $n*m*56$ bytes long using a 224bits Elliptic Curve Digital Signature Algorithm (ECDSA)~\cite{elliptic-curve}, the group public key with size $O(log\thinspace |V|)$, which takes $|V| * 800$ bytes long, and the group membership certificate of size $O (1)$, which takes $|V|*64$ bytes long using Group Signatures with Almost-for-free Revocation (GSAFR)~\cite{libert2012group}. It is important to note that the CA does not need to store vehicle pseudonyms, which reduces the storage overhead found in other works, such as the Zhou's approach~\cite{p2dap2} and \cite{p2dap}. Moreover, the RSUs store the Revocation List of size \textit{O(log r)} (which contains each vehicle's group revocation tokens), which is also small when compared with traditional revocation lists of the public key infrastructure (which stores all non-valid public keys). Finally, vehicles store only the set of \textit{w} pseudonyms (public/private key pairs and digital certificates), which are \textit{w}*56 bytes long, as well as the anonymity set digital certificates, which are $k*m*56$ bytes long, and the public and private group signing keys, which are 800 and 64 bytes long;
	
	%NO NOSSO EXEMPLO ANTERIOR, CADA VEICULO ARMAZENARIA 6720 BYTES - 6,5 MB ou 7,4 (com grupo)
	
	\item \textit{Computation Overhead}: we implemented our security algorithms on a 2.9 GHz Intel Core i7 processor with 8 GB of RAM, for V2V and V2I communications:
	
	\begin{itemize}
		\item On V2V communication: to sign a message in a V2V communication (message detailed in Section~\ref{sec:phase2}), a vehicle $v_{c}$ first signs the payload \textit{d} ($\sigma$) with its group signing key $gsk_{c}$ using GSAFR, which takes $11$ \textit{ms} with computation and size of cost $O (1)$; and afterwards, the whole message with its $i^{th}$ temporary private key $k^{-}_{c, i}$, which takes $0.1$ \textit{ms} using ECDSA. Thus, $v_{c}$ takes $11.1$ \textit{ms} to sign the whole message. On the other hand, when another vehicle $v_{e}$ receives the message, it verifies the message's authentication in two steps: first it verifies the sender's ($v_{c}$) public key $k^{+}_{c, i}$ authenticity, which is  available in the digital certificate $cert_{c, i}$; and second, the whole message authentication itself. Thus, a vehicle must first check the $cert_{c, i}$ authentication using the RSU's public key $k^{+}_{RSU}$, which takes $0.4$ \textit{ms}, and then the whole message's authentication, which also takes $0.4$ \textit{ms}. The total message verification process takes $0.8$ \textit{ms}. It is important to point out that a vehicle does not need to check $cert_{c, i}$ of the subsequent messages nor each anonymity set digital certificates $cert_{AS_{i, j}}$, since the whole message authentication guarantees that the message is from a trusted TPD. Furthermore, $v_{e}$ does not need to check the group digital signature $\sigma$ since it is used mainly for non-repudiation purposes. In short, a vehicle may sign $90$ messages/s, while it may verify 1250 messages/s (or 2500 messages/s after checking the first time).
			
		\item On V2I communication: on Phase 2 of the proposed protocol, a vehicle signs the payload data (UUID and the $v_{c}$'s $i^{th}$ digital certificate) with its group signing key, which takes 16 ms (with computation cost of $O (log\thinspace 1)$), and the request message $m_c$ with ECDSA, which takes 1 ms  (Step 1); when a RSU receives the message $m_c$ (Step 2), it checks the group signature authentication in 132 \textit{ms}, with computation cost of $O (1)$, while it generates each \textit{w} key pair in \textit{w}*83 \textit{ms}, and signs \textit{w} key pairs that takes \textit{w}*1 \textit{ms}. Hence, the total computation cost is 132 \textit{ms} + \textit{w}*83 \textit{ms} +  \textit{w}*1 \textit{ms}. In order to avoid high overhead during key generation, the RSU may generate the set of key pairs previously without waiting for vehicles' pseudonym renewal requests, which reduces $w*83 + w*1$ \textit{ms} in the computation cost.
	\end{itemize}
	
	\item \textit{Communication Overhead}:
	\begin{itemize}
		\item On V2V communication: the beacon message size basically requires one anonymity set digital certificate $cert_{AS_{1,j}}$, which takes 56 bytes in a 224\textit{bit} ECDSA; the group signature $\sigma$ of the payload \textit{d}, which takes 225 bytes (128 bits security level) with signature size of $O (1)$; the $i^{th}$ temporary digital certificate $cert_{v, i}$, which takes 56 bytes; and finally, the whole message authentication, which also takes 56 bytes. Therefore, the minimum message size to be transmitted is 393 bytes. On the other hand, as the number of anonymity set digital certificates increases due to the \textit{sybil} detection phase, the message size is 56 bytes longer. Therefore, Table~\ref{tab:beacontransfertime} summarizes the beacon transfer times (in \textit{milliseconds}) for different WAVE data rates and message sizes (in bytes) as the number of anonymity set levels increases. These results  show that \protocolname~has low communication overhead. In the next subsection, we evaluate the \textit{sybil} detection process for Levels 4, 5 and 6;
		
		\begin{table}[ht]
\caption{Beacon transfer times (\textit{ms}) for different message sizes (bytes) and data rates (Mbps).}
{\small
\hfill{}
\begin{tabular}{l|cccccccc}
\hline
& \multicolumn{8}{c}{Data rates (Mbps) in VANET.}                 \\ \hline
\begin{tabular}[c]{@{}l@{}}Message Size \end{tabular} & 3    & 4.5  & 6    & 9    & 12   & 18   & 24   & 27    \\\hline
393                                                             & 1.04 & 0.69 & 0.52 & 0.34 & 0.26 & 0.17 & 0.13 & 0.11  \\
449                                                             & 1.19 & 0.79 & 0.59 & 0.39 & 0.29 & 0.19 & 0.14 & 0.13  \\
505                                                             & 1.34 & 0.89 & 0.67 & 0.44 & 0.33 & 0.22 & 0.16 & 0.14  \\ 
561                                                             & 1.49 & 0.99 & 0.74 & 0.49 & 0.37 & 0.24 & 0.18 & 0.16  \\
617                                                             & 1.64 & 1.09 & 0.82 & 0.54 & 0.41 & 0.27 & 0.20 & 0.18 \\
673                                                             & 1.79 & 1.19 & 0.89 & 0.59 & 0.44 & 0.29 & 0.22 & 0.19\\\hline
\end{tabular}}
\hfill{}
\label{tab:beacontransfertime}
\end{table}
				
		\item On V2I communication: during Phase 2, a vehicle $v_{c}$ signs the pseudonym  renewal request message including a group signature, which takes 225 bytes (128 bits security level) with signature size of $O (1)$; and attaches the $i^{th}$ temporary digital certificate, taking 56 bytes. Hence, the total message size is 281 bytes. The RSU response includes the new set of temporary key pairs $TK_{v}$ of size $w$, which is $w*56$ bytes longer, as well as the message authentication, which also takes 56 bytes. Thus, the total response size is  $w*56 + 56$ bytes. Table~\ref{tab:transfertimev2i} presents the total time (in \textit{milliseconds}) to transmit \textit{w} key pairs $TK_v$ for different message sizes (in bytes) and data rates. 
		
		\begin{table}[ht]
\caption{Total time (\textit{ms}) to transmit $TK_v$ for different message sizes (bytes) and data rates (Mbps).}
{\small
\hfill{}
\begin{tabular}{lc|cccccccc}
\hline
& \multicolumn{9}{c}{Data rates (Mbps) in VANET.}                 \\ \hline
\begin{tabular}[c]{@{}l@{}} \textit{w} \end{tabular} 
         & Size  & 3             & 4.5      & 6         & 9         & 12       & 18      & 24       & 27  \\\hline
10  & 616     & 1.642     & 1.095 & 0.821 & 0.547 & 0.410 & 0.273 & 0.205 & 0.182  \\
20  & 1176   & 3.136     & 2.090 & 1.568 & 1.045 & 0.784 & 0.522 & 0.392 & 0.348 \\
30  & 1736   & 4.629     & 3.086 & 2.314 & 1.543 & 1.157 & 0.771 & 0.578 & 0.514  \\ 
40  & 2296   & 6.122     & 4.081 & 3.061 & 2.040 & 1.530 & 1.020 & 0.765 &  0.680  \\
50  & 2856   & 7.616     & 5.077 & 3.808 & 2.538 & 1.904 & 1.269 & 0.952 & 0.846 \\
60  & 3416   & 9.109     & 6.072 & 4.554 & 3.036 & 2.277 & 1.518 & 1.138 & 1.012 \\
70  & 3976   & 10.60     & 7.068 & 5.301 & 3.534 & 2.650 & 1.767 & 1.325 & 1.178 \\
80  & 4536   & 12.09     & 8.063 & 6.047 & 4.031 & 3.023 & 2.015 & 1.511 & 1.343 \\
90  & 5096   & 13.58     & 9.059 & 6.794 & 4.529 & 3.397 & 2.264 & 1.698 & 1.509 \\
100  & 5656 & 15.082  & 10.05 & 7.541 & 5.027 & 3.770 & 2.513 & 1.885 & 1.675 \\\hline
\end{tabular}}
\hfill{}
\label{tab:transfertimev2i}
\end{table}
		
	\end{itemize}
\end{itemize}
	
In a VANET, energy and computational power constraints are not relevant issues when compared to other types of wireless mobile and sensor networks~\cite{Lim201394}. Due to the decreasing costs and recent improvements on microprocessors and flash memory, our combination of cryptography schemes, such as group signature and asymmetric key pairs, are possible candidates to provide privacy-preserving authentication and non-repudiation in VANETs.

\subsection{Correctness Verification of the Pseudonym Renovation Protocol}
\label{sec:authenticationCorrectness}

In this section, we formally verify the correctness of the pseudonym renewal protocol (Phase 2) based on the BAN logic, which is a formal logic used to reason about beliefs, encryption, and protocols. The following four postulates of the BAN logic were used in order to prove the correctness of the proposed protocol. Let P and Q be two abstract entities, while X and Y are formulas:

\begin{enumerate}
\renewcommand{\theenumi}{\Alph{enumi}}
	\item ${\displaystyle \frac{P \vDash Q \overset{Y}{\rightleftharpoons} P, P \triangleleft <X>Y}{P \vDash Q \mid\thicksim X}}$: if P believes that it shares Y with Q, and P receives X combined with Y, then, P believes that Q said X;
	
	\item ${\displaystyle \frac{P \vDash \#(X), P \vDash Q \mid\thicksim X }{P \vDash Q \vDash X}}$: if P believes that X has been uttered only recently, and P believes that Q said X, then, P believes that Q believes in X;

	\item ${\displaystyle \frac{P \vDash Q \Rightarrow X, P \vDash Q \vDash X }{P \vDash X}}$: if P believes that Q is responsible for X, and P believes that Q believes in X, then P believes in X;	
	
	\item ${\displaystyle \frac{P \vDash \#(X)}{P \vDash \#(Y,X)}}$: if P believes that X has been uttered only recently, then the whole formula has been uttered only recently;
		
	\item ${\displaystyle \frac{P \vDash \overset{K^+}{\longrightarrow} P, P \triangleleft \{ X \}_{K^+} }{P \triangleleft  X}}$: if P has the public key $K^+$ and P receives a message X encrypted with key $K^+$, then, P receives X. 
	
\end{enumerate}

Table~\ref{tab:idealizedprotocol} summarizes the idealized protocol in BAN Logic syntax:%, with the following nomenclatures: Y is the $i^{th}$ $v_{c}$'s temporary digital certificate $cert_{c,i} \in Tk_{c, w}$; Z is the $i^{th}$ $v_{c}$'s public key $k^{+}_{c,i} \in cert_{c, i}$; X denotes the request on Step 1 of the proposed pseudonym renewal protocol; and, finally, P represents the new set of temporary public/private key pairs $Tk^{'}_{c, w}$ to vehicle $v_{c}$.

\vspace{0.5cm}

\tablefirsthead{%
\hline
\multicolumn{1}{c}{Steps} &
\multicolumn{1}{c}{BAN Description} \\
\hline}
\tablehead{%
\hline
\multicolumn{2}{l}{\small\sl continued from previous page}\\
\hline
\multicolumn{1}{c}{Steps} &
\multicolumn{1}{c}{BAN Description} \\
\hline}
\tabletail{%
\hline
\multicolumn{2}{r}{\small\sl continued on next page}\\
\hline}
\tablelasttail{\hline}

\topcaption{The idealized protocol in BAN Logic syntax and descriptions.}
\begin{supertabular}{l@{\hspace{3mm}}l@{\hspace{30mm}}}
\label{tab:idealizedprotocol}
Step 1 & $v_{c} \rightarrow RSU_{n}: \{<UUID, cert_{c, i}>m_{c}\}_{k^{+}_{RSU}}$\\
Step 3 & $RSU_{n} \rightarrow v_{c}: \{<TK'_{c}> UUID\}_{k^{+}_{c, i}}$ \\ 
\end{supertabular}

\vspace{0.5cm}

The Steps 1 through 11 bellow describe the assumptions considered by the verification process, while Table~\ref{tab:goals} summarizes the goals of correctness verification. The goal is to check if the vehicle and RSU trust the received messages. In other words, if the request is fresh and, hence, it is not originated from replay attacks, as well as if the message's data are authentic.

\begin{enumerate}
	\item $RSU_{n} \vDash v_{c} \overset{cert_{c,i}}{\rightleftharpoons} RSU_{n}$: RSU believes that it shares the $v_{c}$'s $i^{th}$ digital certificate $cert_{c,i}$ with vehicle $v_{c}$. This is possible since $Signed^{cert_{c,i}}_{RSU}$ for any RSU;
	\item $RSU_{n} \vDash \#(m_c)$; RSU believes that the $v_{c}$'s message request has been uttered only recently. This is possible through the message's timestamp;
	\item $RSU_{n} \vDash v_{c} \Rightarrow m_{c}$: RSU believes that $v_{c}$ is responsible for message $m_{c}$;
	\item $RSU_{n} \triangleleft \{<UUID, cert_{c, i}> m_{c}\}_{k^+_{RSU}}$: RSU receives the request $m_{c}$ with the random $v_{c}$'s $UUID_{c}$ and the $i^{th}$ digital certificate $cert_{c, i}$ encrypted with its public key;
	\item $v_{c} \triangleleft \{<TK_{c}> UUID_{c}\}_{K^{+}_{c,i}}$: $v_{c}$ receives the new set of pseudonyms and its $UUID_{c}$ encrypted with its $i^{th}$ public key;
	\item $v_{c} \vDash RSU_{n} \overset{k^{+}_{c, i}}{\rightleftharpoons} v_{c}$: $v_{c}$ believes that it shares its $i^{th}$ public key with the RSU;
	\item $v_{c} \vDash RSU_{n} \Rightarrow TK_{c}$: $v_{c}$ believes that RSU is responsible for $TK_{c}$;
	\item $v_{c} \vDash \#(TK_{c})$: $v_{c}$ believes that the new set of pseudonyms is new; 
	\item $RSU_{n} \vDash \overset{k^{+}_{RSU}}{\longrightarrow} RSU_{n}$: RSU believes that it has a public key;
	\item $RSU_{n} \vDash v_{c} \overset{k^{+}_{RSU}}{\rightleftharpoons} RSU_{n}$: RSU believes that it shares its public key with $v_{c}$;
	\item $v_{c} \vDash \overset{k^{+}_{c, i}}{\longrightarrow} v_{c}$: $v_{c}$ believes that it has its $i^{th}$ public key.
\end{enumerate} 


\tablefirsthead{%
\hline
\multicolumn{1}{c}{Goal} &
\multicolumn{1}{c}{BAN Syntax} &
\multicolumn{1}{c}{Description} \\
\hline}
\tablehead{%
\hline
\multicolumn{2}{l}{\small\sl continued from previous page}\\
\hline
\multicolumn{1}{c}{Goal} &
\multicolumn{1}{c}{BAN Description} &
\multicolumn{1}{c}{Description} \\
\hline}
\tabletail{%
\hline
\multicolumn{2}{r}{\small\sl continued on next page}\\
\hline}
\tablelasttail{\hline}
\topcaption{Goals of the Correctness Verification.}
\begin{supertabular}{l@{\hspace{3mm}}l@{\hspace{5mm}}l}
\label{tab:goals}
  1 & $RSU_{n} \vDash m_{c}$ & RSU believes the request $m_c$.\\ 
  2 & $RSU_{n} \vDash \#(UUID_c, cert_{c,i})$ & \pbox{20cm}{RSU believes that the request $m_c$ and the $v_{c}$'s \\ $i^{th}$ digital certificate and UUID are fresh.}  \\ 
  3 & $v_{c} \vDash TK_c$ & \pbox{20cm}{$v_{c}$ believes the new set of  pseudonym.}\\ 
  4 & $v_{c} \vDash \#(TK_c, UUID_c)$ & \pbox{20cm}{$v_{c}$ believes that the RSU response and the set \\ of pseudonyms are fresh.} \\
\end{supertabular}

\vspace{0.5cm}

The verification process is as follows:

\begin{enumerate}
\renewcommand{\theenumi}{\Roman{enumi}}
	\item Postulate E applied to assumptions 4 and 9:
	
		${\displaystyle \frac{RSU_n \vDash \overset{K^+_{RSU}}{\longrightarrow} RSU_{n}, RSU_{n} \triangleleft \{<UUID_c, cert_{c, i}> m_{c}\}_{k^+_{RSU}} } {RSU \triangleleft  <UUID_c, cert_{c, i}>m_{c}}}$: if RSU believes that it has the public key $k^{+}_{RSU}$ and it receives a message $<UUID_c, cert_{c, i}> m_{c}$ encrypted with key $k^{+}_{RSU}$, the RSU receives $<UUID_c, cert_{c, i}> m_{c}$;

	\item Postulate A applied to assumptions 1 and  to result I:
	 
		${\displaystyle \frac{RSU_{n} \vDash v_{c} \overset{cert_{c, i}}{\rightleftharpoons} RSU_{n}, RSU_{n} \triangleleft <UUID_c, cert_{c, i}>m_{c}}{RSU_{n} \vDash v_{c} \mid\thicksim m_c}}$: if RSU believes that it shares the $i^{th}$ digital certificate $cert_{c, i}$ with vehicle $v_{c}$, and it receives the request $m_{c}$ combined with $cert_{c, i}$, then it believes that $v_{c}$ once sent $m_{c}$;
	
	\item Postulate B applied to assumption 2 and to result II:
	
		${\displaystyle \frac{RSU_{n} \vDash \#(m_c), RSU_{n} \vDash v_{c} \mid\thicksim m_c }{RSU_{n} \vDash v_{c} \vDash m_c}}$: if RSU believes that the request $m_c$ could have been uttered only recently (through the message timestamp), and the RSU believes that the vehicle $v_{c}$ once sent $m_c$, then the RSU believes that $v_{c}$ believes $m_c$;
	
	\item Postulate C applied to assumption 3 and to result III: 
	
		${\displaystyle \frac{RSU_{n} \vDash v_{c} \Rightarrow m_c, RSU_{n} \vDash v_{c} \vDash m_c }{RSU_{n} \vDash m_c}}$: if the RSU believes that the vehicle $v_{c}$ has jurisdiction over $m_c$ (due to the $i^{th}$ digital certificate $cert_{c, i}$), and RSU trusts $v_{c}$ on the truth of $m_c$, then, RSU trusts $m_c$. Hence, \textit{goal 1 is achieved};
		
	\item Postulate D applied to assumption 2: 
		
		${\displaystyle \frac{RSU \vDash \#(m_c)}{RSU \vDash \#(UUID_c,cert_{c,i})}}$: if the RSU believes that the request $m_c$ is fresh, then the entire message is also fresh. Hence, \textit{goal 2 is achieved};
		
	\item Postulate E applied to assumptions 5 and 11:
	
		${\displaystyle \frac{v_c \vDash \overset{K^{+}_{c,i}}{\longrightarrow} v_c, v_c \triangleleft \{ <TK_c>UUID_c \}_{K^{+}_{c,i}} }{v_c \triangleleft  <TK_c>UUID_c}}$: if $v_{c}$ believes that it has its $i^{th}$ public key $K^{+}_{c,i}$ and $v_{c}$ receives a message response encrypted with its public key $K^{+}_{c,i}$, then, $v_{c}$ receives $<TK_c> UUID_c$; 
		

	\item Postulate A applied to assumption 6 and to result VI:
	
		${\displaystyle \frac{v_{c} \vDash RSU_{n} \overset{k^{+}_{c,i}}{\rightleftharpoons} v_{c}, v_{c} \triangleleft <TK_c> UUID_c}{v_{c} \vDash RSU \mid\thicksim TK_c}}$: if the vehicle $v_{c}$ believes that it shares its public key $k^{+}_{c,i}$ with the RSU, and it receives the set of new public/private key pairs $TK_c$ from RSU combined with its $UUID_c$, then the vehicle $v_{c}$ believes that RSU once sent $TK_c$;
		
	\item Postulate B applied to assumption 8 and to result VII:
		
		${\displaystyle \frac{v_{c} \vDash \#(TK_c), v_{c} \vDash RSU_{n} \mid\thicksim TK_c}{v_{c} \vDash RSU_{n} \vDash TK_c}}$: if the vehicle $v_{c}$ believes that the new set of public/private key pairs $TK_c$ could have been uttered only recently, and the $v_{c}$ believes that the RSU once sent $TK_c$, then $v_{c}$ believes that the RSU believes $TK_c$;
	
	\item Postulate C applied to assumption 7 and to result VIII:
	
		${\displaystyle \frac{v_{c} \vDash RSU_{n} \Rightarrow TK_c, v_{c} \vDash RSU_{n} \vDash TK_c}{v_{c} \vDash TK_c}}$: if vehicle $v_{c}$ believes that the RSU has jurisdiction over the new set of public/private key pairs $TK_c$ (once the RSU digitally signs each key pair), and the vehicle $v_{c}$ trusts RSU on the truth of $TK_c$, then $v_{c}$ trusts $TK_c$. Hence, \textit{goal 3 is achieved};
		
	\item Postulate D applied to assumption 8:
	
	${\displaystyle \frac{v_{c} \vDash \#(TK_c)}{v_{c} \vDash \#(TK_c, UUID_c)}}$: if the vehicle $v_{c}$ believes the set of new public/private key pairs $TK_c$ is fresh (once each key pair digital certificate also carries a timestamp), then the whole formula is also fresh. That is, the RSU response message is also fresh. Hence, \textit{goal 4 is achieved}.
\end{enumerate}

Finally, according to the Equations IV, V, IX and X, they accomplish the verification correctness together. 

%s, as deeply discussed by Yang et al~\cite{yang2006limitation}

One of the most important threat to security is called \textit{man-in-the-middle} (MITM) attack. A successful MITM attack, within our context, would result in two vehicles - $v_{c}$ and a malicious vehicle $v_{attacker}$ - to store the same set of temporary key pairs $TK_{c == attacker}$. Therefore, the attacker would explore network attacks on behalf of $v_{c}$ (but $v_{attacker}$ could also be prosecuted and identified based on the group signature $\sigma$, without compromising $v_{c}$'s reliability).

We informally describe that our authentication protocol is secure against MITM in two levels, as detailed as follows: suppose a malicious vehicle $v_{attacker}$ (insider) eavesdrops on the wireless channel and intercepts $v_{c}$'s request message $m_{c}$. Therefore, it generates a new request message $m_{attacker}$ by signing $\sigma$ as $payload = UUID_{attacker} || cert_{attacker, i}$. After receiving $m_{attacker}$ and validating it, the RSU generates the new set $TK_{attacker}$ and sends it back, combined with $UUID_{attacker}$. In addition, to complete the attack, $v_{attacker}$ must return to $v_{c}$ the new set $TK_{attacker}$ as following: $E(k^{+}_{c, i}, TK_{c = attacker} || UU\\ID_{c})$. However, $v_{attacker}$ can not encrypt the whole message with the $i^{th}$ $v_{c}$'s public key ($k^{+}_{c,i}$), since $v_{attacker}$ can not capture $cert_{c, i}$ from the original message $m_{c}$. On the other hand, suppose that $v_{attacker}$ captured $cert_{c, i}$ (when $v_{c}$ attached it on earlier messages) and extracted $k^{+}_{c, i}$. Even so, the attacker would have to find out the $v_{c}$'s random value $UUID_c$, which is impossible since $v_{attacker}$ does not have RUS's private key.

%In this section, we formally verify the correctness of the pseudonym renewal protocol (Phase 2) based on the BAN logic, which is a formal logic used to reason about beliefs, encryption, and protocols. The following four postulates of the BAN logic were used in order to prove the correctness of the proposed protocol. Let P and Q be two abstract entities, while X and Y are formulas:
%
%\begin{enumerate}
%\renewcommand{\theenumi}{\Alph{enumi}}
%	\item ${\displaystyle \frac{P \vDash Q \overset{Y}{\rightleftharpoons} P, P \triangleleft <X>Y}{P \vDash Q \mid\thicksim X}}$;
%	
%	\item ${\displaystyle \frac{P \vDash \#(X), P \vDash Q \mid\thicksim X }{P \vDash Q \vDash X}}$;
%
%	\item ${\displaystyle \frac{P \vDash Q \Rightarrow X, P \vDash Q \vDash X }{P \vDash X}}$;	
%	
%	\item ${\displaystyle \frac{P \vDash \#(X)}{P \vDash \#(Y,X)}}$.
%\end{enumerate}
%
%Table~\ref{tab:idealizedprotocol} summarizes the idealized protocol in BAN Logic syntax, with the following nomenclatures: Y is the $i^{th}$ $v_{c}$'s temporary digital certificate $cert_{c,i} \in Tk_{c, w}$; Z is the $i^{th}$ $v_{c}$'s public key $k^{+}_{c,i} \in cert_{c, i}$; X denotes the request on Step 1 of the proposed pseudonym renewal protocol; and, finally, P represents the new set of temporary public/private key pairs $Tk^{'}_{c, w}$ to vehicle $v_{c}$.
%
%\begin{center}
%\tablefirsthead{%
%\hline
%\multicolumn{1}{|c}{Steps} &
%\multicolumn{1}{c|}{BAN Description} \\
%\hline}
%\tablehead{%
%\hline
%\multicolumn{2}{|l|}{\small\sl continued from previous page}\\
%\hline
%\multicolumn{1}{|c}{Steps} &
%\multicolumn{1}{c|}{BAN Description} \\
%\hline}
%\tabletail{%
%\hline
%\multicolumn{2}{|r|}{\small\sl continued on next page}\\
%\hline}
%\tablelasttail{\hline}
%\vspace{2cm}
%\topcaption{Idealized Protocol.}
%\begin{supertabular}{|l@{\hspace{3mm}}|l@{\hspace{37mm}}|}
%\label{tab:idealizedprotocol}
%  Step 1 & $v_{c} \rightarrow RSU_{n}: <X>Y$\\
%  Step 3 & $RSU_{n} \rightarrow v_{c}: \{P\}_{Z}$ \\
%\end{supertabular}
%\end{center}
%
%The Steps 1 through 8 bellow describe the assumptions considered to the verification process, while Table~\ref{tab:goals} summarizes the goals of correctness verification. The goal is to check if the vehicle and RSU trust the received messages. In other words, if the request is fresh and, hence, it is not originated from replay attacks, as well as if the message's data are authentic.
%
%\begin{enumerate}
%	\item $RSU_{n} \vDash v_{c} \overset{Y}{\rightleftharpoons} RSU_{n}$;
%	\item $RSU_{n} \vDash \#(X)$;
%	\item $RSU_{n} \vDash v_{c} \Rightarrow X$;
%	\item $RSU_{n} \triangleleft <X> Y$;
%	\item $v_{c} \triangleleft <P>Z$;
%	\item $v_{c} \vDash RSU_{n} \overset{Z}{\rightleftharpoons} v_{c}$;
%	\item $v_{c} \vDash RSU_{n} \Rightarrow P$;
%	\item $v_{c} \vDash \#(P)$.
%\end{enumerate} 
%
%\begin{center}
%\tablefirsthead{%
%\hline
%\multicolumn{1}{|c}{Goal} &
%\multicolumn{1}{|c|}{BAN Syntax} &
%\multicolumn{1}{c|}{Description} \\
%\hline}
%\tablehead{%
%\hline
%\multicolumn{2}{|l|}{\small\sl continued from previous page}\\
%\hline
%\multicolumn{1}{|c}{Goal} &
%\multicolumn{1}{|c|}{BAN Description} &
%\multicolumn{1}{c|}{Description} \\
%\hline}
%\tabletail{%
%\hline
%\multicolumn{2}{|r|}{\small\sl continued on next page}\\
%\hline}
%\tablelasttail{\hline}
%\topcaption{Goals of the Correctness Verification.}
%
%\begin{supertabular}{|l@{\hspace{3mm}}|l@{\hspace{5mm}}|l|}
%\label{tab:goals}
%  1 & $RSU_{n} \vDash X$ & RSU believes the request \textit{m}.\\ \hline
%  2 & $RSU_{n} \vDash \#(Y,X)$ & \pbox{20cm}{RSU believes that the \\ request \textit{m} and the $v_{c}$'s \\ digital certificate are fresh.}  \\ \hline
%  3 & $v_{c} \vDash P$ & \pbox{20cm}{$v_{c}$ believes the new set of \\ pseudonym.}\\ \hline
%  4 & $v_{c} \vDash \#(P,Z)$ & \pbox{20cm}{$v_{c}$ believes that the RSU \\ response is fresh.} \\
%\end{supertabular}
%\end{center}
%
%The verification process is as follows:
%
%\begin{enumerate}
%\renewcommand{\theenumi}{\Roman{enumi}}
%	\item Postulate A applied to assumptions 1 and 4:
%	 
%		${\displaystyle \frac{RSU_{n} \vDash v_{c} \overset{Y}{\rightleftharpoons} RSU_{n}, RSU_{n} \triangleleft <X>Y}{RSU_{n} \vDash v_{c} \mid\thicksim X}}$: if RSU believes that it shares the secret Y with vehicle $v_{c}$, and it receives the request X combined with Y, then it believes that $v_{c}$ once sent X;
%	
%	\item Postulate B applied to assumption 2 and to result I:
%	
%		${\displaystyle \frac{RSU_{n} \vDash \#(X), RSU_{n} \vDash v_{c} \mid\thicksim X }{RSU_{n} \vDash v_{c} \vDash X}}$: if RSU believes that the request X could have been uttered only recently (through the message timestamp), and the RSU believes that the vehicle $v_{c}$ once sent X (due to the $i^{th}$ digital certificate $cert_{k, i}$), then the RSU believes that $v_{c}$ believes X;
%	
%	\item Postulate C applied to assumption 3 and result II: 
%	
%		${\displaystyle \frac{RSU_{n} \vDash v_{c} \Rightarrow X, RSU_{n} \vDash v_{c} \vDash X }{RSU_{n} \vDash X}}$: if the RSU believes that the vehicle $v_{c}$ has jurisdiction over X (due to the $i^{th}$ digital certificate $cert_{c, i}$), and RSU trusts $v_{c}$ on the truth of X, then, RSU trusts X. Hence, goal 1 is achieved;
%		
%	\item Postulate D applied to assumption 2: 
%		
%		${\displaystyle \frac{RSU \vDash \#(X)}{RSU \vDash \#(Y,X)}}$: if the RSU believes that the request X is fresh, then the entire message is also fresh. Hence, goal 2 is achieved;
%
%\item Postulate A applied to assumptions 5 and 6:
%	
%		${\displaystyle \frac{v_{c} \vDash RSU_{n} \overset{Z}{\rightleftharpoons} v_{c}, v_{c} \triangleleft <P>Z}{v_{c} \vDash RSU \mid\thicksim P}}$: if the vehicle $v_{c}$ believes that it shares its public key Z with the RSU, and it receives the set of new public/private key pairs P from RSU combined with Z, then the vehicle $v_{c}$ believes that RSU once sent P;
%		
%	\item Postulate B applied to assumption 8 and to result V:
%		
%		${\displaystyle \frac{v_{c} \vDash \#(P), v_{c} \vDash RSU_{n} \mid\thicksim P }{v_{c} \vDash RSU_{n} \vDash P}}$: if the vehicle $v_{c}$ believes that the new set of public/private key pairs P could have been uttered only recently, and the $v_{c}$ believes that the RSU once sent P, then $v_{c}$ believes that the RSU believes P;
%	
%	\item Postulate C applied to assumption 7 and to result VI:
%	
%		${\displaystyle \frac{v_{c} \vDash RSU_{n} \Rightarrow P, v_{c} \vDash RSU_{n} \vDash P}{v_{c} \vDash P}}$: if vehicle $v_{c}$ believes that the RSU has jurisdiction over the new set of public/private key pairs P (once the RSU digitally signs each key pair), and the vehicle $v_{c}$ trusts RSU on the truth of P, then $v_{c}$ trusts P. Hence, goal 3 is achieved;
%		
%	\item Postulate D applied to assumption 8:
%	
%	${\displaystyle \frac{v_{c} \vDash \#(P)}{v_{c} \vDash \#(P,Z)}}$: if the vehicle $v_{c}$ believes the set of new public/private key pairs P is fresh (once each key pair digital certificate also carries a timestamp), then the whole formula is also fresh. That is, the RSU response message is also fresh. Hence, goal 4 is achieved.
%\end{enumerate}
%
%Finally, according to the Equations III, IV, VII and VIII, they accomplish the verification correctness together. 

\subsection{Sybil Attack Detection Evaluation Results}
The \textit{sybil} detection evaluation aimed to answer three questions, summarized as follows:

\begin{enumerate}
 \item If two different vehicles $v_{i}$ and $v_{j}$ are in the transmission range of each other ($v_{i}$, $v_{j} \in V_{l}$), and both belong to the same anonymity sets (considering property 4 of the multilevel anonymity set architecture), what is the average time that another vehicle $v_{k} \in V_{l}$ takes to decide that the messages are, in fact, from two different vehicles, and not from a (potential) \textit{sybil} node?

 \item What is the average time one vehicle takes to detect a \textit{sybil} attack from \textit{beacon} messages?

\item What are the false-positive (a legitimate node is evaluated as \textit{sybil}) and false-negative (a \textit{sybil} node was not evaluated as one) detection rates?
\end{enumerate}

The simulation was performed by using the Veins simulation environment, which is based on OMNeT++ framework for event-based network simulation, and SUMO for road traffic microsimulation. Furthermore, it considered different vehicle densities, beacon frequencies (Packet Transmission Rate), and different anonymity set levels. Table~\ref{tab:simulation-parameters} summarizes the simulation parameters. 

\begin{center}
\begin{table}[ht]
\caption{Simulation parameters.}
{\small
\hfill{}
\begin{tabular}{ll}
\hline
Parameter & Value \\ \hline 
Total number of executions & 900 \\ 
Simulation Duration & between 10s to 120s\\
MAC and PHY protocols & 802.11p\\
Transmission Power & 20mW\\
Bit rate & 18Mbps\\
Beacon rates & 3, 5, and 10 beacon/s\\
Number of Vehicles & 3, 5, 7, 12, 17, 22, 25, 30, 40, 50, 60, 70, 80, 90, 100\\
Mobility model & Krauss \\
Average vehicle speed & between 15 m/s and 22 m/s\\
Anonymity set levels (\textit{m}) & 4, 5 and 6\\
\hline
\end{tabular}}
\hfill{}
\label{tab:simulation-parameters}
\end{table}
\end{center}
%
%\begin{footnotesize}
%\tablefirsthead{%
%\hline
%\multicolumn{1}{c}{Parameter} &
%\multicolumn{1}{c}{Value} \\
%\hline}
%\tablehead{%
%\hline
%\multicolumn{2}{l}{\small\sl continued from previous page}\\
%\hline
%\multicolumn{1}{c}{Parameter} &
%\multicolumn{1}{c}{Value} \\
%\hline}
%\tabletail{%
%\hline
%\multicolumn{2}{r}{\small\sl continued on next page}\\
%\hline}
%\tablelasttail{\hline}
%\topcaption{Simulation Parameters.}
%\begin{supertabular}{l@{\hspace{3mm}}l@{\hspace{1mm}}}
%\label{tab:simulation-parameters}
%Hardware platform & 2.9 GHz Intel Core i7 processor, 8 GB of RAM \\ 
%Total number of executions & 900 \\ 
%Simulation Duration & between 10s to 120s\\
%MAC and PHY protocols & 802.11p\\
%Transmission Power & 20mW\\
%Bit rate & 18Mbps\\
%Beacon rates & 3, 5, and 10 beacon/s\\
%Number of Vehicles & 3, 5, 7, 12, 17, 22, 25, 30, 40, 50, 60, 70, 80, 90, 100\\
%Mobility model & Krauss \\
%Average vehicle speed & between 15 m/s and 22 m/s\\
%Anonymity set levels (\textit{m}) & 4, 5 and 6\\
%\end{supertabular}
%\end{footnotesize}
%\vspace{0.5cm}

Figures~\ref{fig:resultados-nao-sybil} and \ref{fig:resultados-sybil} illustrate the experimental results (average time on 95\% confidence intervals) for the first and the second questions, considering 100 \textit{ms}, 200 \textit{ms} and 300 \textit{ms} beacon message transmission intervals. This experimental approach is based on the assumption that it is possible to send beacons as frequently as possible but without overloading the communication channel~\cite{sommer2011traffic}. The solution adaptively updates the beacon frequency based on the importance of messages and based on the available capacity of the wireless channel.

%\begin{figure}[!hb]
%     \centering
%     \subfloat[Average detection time for two suspects and 10 packets per second (100 \textit{ms} beacon interval).]{\includegraphics[width=2.5in]{figures/grafico-resultados-nao-sybil-100-en.pdf}\label{fig:grafico-resultados-nao-sybil-100-en}} 
%     \subfloat[Average detection time for two suspects and 5 packets per second (200 \textit{ms} beacon interval).]{\includegraphics[width=2.5in]{figures/grafico-resultados-nao-sybil-200-en.pdf}\label{fig:grafico-resultados-nao-sybil-200-en}}
%     \subfloat[Average detection time for two suspects and 3 packets per second (300 \textit{ms} beacon interval).]{\includegraphics[width=2.5in]{figures/grafico-resultados-nao-sybil-300-en.pdf}\label{fig:grafico-resultados-nao-sybil-300-en}} \\
%     \caption{The average time to detect two benign vehicles in the transmission range. The vehicles belong to the same $m - 1$ anonymity sets (detection time in seconds and confidence level of 95\%).}
%\label{fig:resultados-nao-sybil}
%\end{figure}

The experiments considered the worst scenarios for a given level \textit{m} of the proposed multilevel anonymity set architecture. Thus, the anonymity sets digital certificates from two vehicles were different only at the anonymity set of the last level. In this context, Equation~\ref{eq:sybil-detection-eq} was satisfied only at Levels 4, 5 or 6. 


Figures~\ref{fig:grafico-resultados-nao-sybil-100-en}, \ref{fig:grafico-resultados-nao-sybil-200-en} and \ref{fig:grafico-resultados-nao-sybil-300-en} depict the average time to detect two benign vehicles that belong to the same anonymity set at Levels 3, 4, or 5 for 100, 200, and 300 beacon intervals, respectively. In short, the time to detect was lower than 0.4, 0.7, and 1 second, respectively. Since the contention is expected to be higher as the number of vehicles increases, the impact on the results was quite minimal. Moreover, the \protocolname~has low impact on the V2V communication standard mainly due to two reasons: first, the vehicles at the same anonymity sets update to the last anonymity set level fast (e.g.: as detailed in Figure~\ref{fig:sybildetectionexecution}, $v_e$ updates from Level 1 to Level 3); and the probability that two or more vehicles, in the same transmission range, will choose the same $m-1$ anonymity set digital certificates ($CERT^{t}_{AS_{v}}$) is ${\displaystyle \prod_{i=1}^{m-1}  \frac{1}{k}}$, which is very low (e.g. $k = 20$). Therefore, the proposed approach provides a stable average of detection time as the number of nodes increases. 

\begin{figure}[H]%
\centering
\subfloat[]{\includegraphics[scale=.3]{figures/grafico-resultados-nao-sybil-100-en-final.jpg}\label{fig:grafico-resultados-nao-sybil-100-en}}\hspace{.5cm}%
\subfloat[]{\includegraphics[scale=.3]{figures/grafico-resultados-nao-sybil-200-en-final.jpg}\label{fig:grafico-resultados-nao-sybil-200-en}}\\
\subfloat[]{\includegraphics[scale=.3]{figures/grafico-resultados-nao-sybil-300-en-final.jpg}\label{fig:grafico-resultados-nao-sybil-300-en}}
\caption{\footnotesize{The average time to detect two benign vehicles in the transmission range. The vehicles belong to the same $m - 1$ anonymity sets. (a) 10 packets per second (100 \textit{ms} beacon interval); (b) 5 packets per second (200 \textit{ms} beacon interval); (c) 3 packets per second (300 \textit{ms} beacon interval).}}
\label{fig:resultados-nao-sybil}
\end{figure}


Figures~\ref{fig:grafico-resultados-sybil-100-en}, \ref{fig:grafico-resultados-sybil-200-en} and \ref{fig:grafico-resultados-sybil-300-en} depict the average time to detect a \textit{sybil} vehicle with three different identities. Similarly, the wireless contention had minimum impact as the number of vehicle increases. On the other hand, the results exceeded 1 second for 300 \textit{ms} beacon interval at Levels 5 and 6. This happens since the neighbor vehicles must evaluate Equation~\ref{eq:wait-time} in order to wait for the next anonymity set digital certificates before deducing a \textit{sybil} attack.

\begin{figure}[H]%
\centering
\subfloat[]{\includegraphics[scale=.3]{figures/grafico-resultados-sybil-100-en-final.jpg}\label{fig:grafico-resultados-sybil-100-en}}\hspace{.5cm}%
\subfloat[]{\includegraphics[scale=.3]{figures/grafico-resultados-sybil-200-en-final.jpg}\label{fig:grafico-resultados-sybil-200-en}}\\
\subfloat[]{\includegraphics[scale=.3]{figures/grafico-resultados-sybil-300-en-final.jpg}\label{fig:grafico-resultados-sybil-300-en}}
\caption{\footnotesize{The average time to detect a \textit{sybil} vehicle when another benign vehicle in the transmission range belongs to the same $m - 1$ anonymity sets. (a) 10 packets per second (100 \textit{ms} beacon interval); (b) 5 packets per second (200 \textit{ms} beacon interval); (c) 3 packets per second (300 \textit{ms} beacon interval).}}
\label{fig:resultados-sybil}
\end{figure}

Finally, the main parameters that may affect the \textit{sybil} detection are the beacon time intervals and the number of anonymity sets (per level) in which two or more vehicles together belong to. The results are considered acceptable since the messages from a \textit{sybil} vehicle are dropped (and kept for future purposes) by neighboring vehicles during the attack, and the average detection time is faster than other approaches (as discussed on next section). Moreover, most of the safety-based applications for VANETs require fast drivers' reactions (e.g., \textit{blind spot} scenarios) and therefore, they demand fast decision protocols.

%\begin{figure}[h]
%     \centering
%     \subfloat[Average detection time for one \textit{Sybil} attacker and 10 packets per second (100 \textit{ms} beacon interval).]{\includegraphics[width=2.5in]{figures/grafico-resultados-sybil-100-en.pdf}\label{fig:grafico-resultados-sybil-100-en}}
%     \subfloat[Average detection time for one \textit{Sybil} attacker and 5 packets per second (200 \textit{ms} beacon interval).]{\includegraphics[width=2.5in]{figures/grafico-resultados-sybil-200-en.pdf}\label{fig:grafico-resultados-sybil-200-en}}
%     \subfloat[Average detection time for one \textit{Sybil} attacker and 3 packets per second (300 \textit{ms} beacon interval).]{\includegraphics[width=2.5in]{figures/grafico-resultados-sybil-300-en.pdf}\label{fig:grafico-resultados-sybil-300-en}}
%     \caption{The average time to detect a \textit{sybil} vehicle when another benign vehicle in the transmission range belongs to the same $m - 1$ anonymity sets (detection time in seconds and confidence level of 95\%).}
%\label{fig:resultados-sybil}
%\end{figure}

The other two evaluated metrics were the \textit{false-positve} and \textit{false-negative} \textit{sybil} detection rates. Figure~\ref{fig:false-positive-result-scenario} depicts a scenario in which  the former metric was evaluated in 0,28\% of the experimental cases. It is a classical hidden terminal scenario where vehicles \textit{C} and \textit{A} belong to the same first level anonymity set (e.g.: $AS_{1,2}$). The vehicle \textit{B} receives beacon messages from the vehicles \textit{C} and \textit{A}. However, due to the \textit{A}'s and \textit{C}'s transmission ranges, neither \textit{A} nor \textit{C} receive the messages from each other. Therefore, they keep sending messages with their first level anonymity set digital certificate $cert_{AS_{1,2}}$. From the \textit{B}'s perspective, since the vehicles \textit{A} and \textit{C} keep sending messages without presenting the next anonymity set digital certificates, after $\delta$ \textit{ms} (Equation~\ref{eq:wait-time}), \textit{B} evaluates \textit{A}'s and \textit{C}'s messages as originated from a \textit{sybil} vehicle. However, both A and C are two benign vehicles.

\begin{figure}[ht]
\centering
\includegraphics[scale=.45]{figures/false-positive-scenario.jpg}
\caption{Hidden terminals scenarios may lead to false-positive \textit{sybil} detections.}
\label{fig:false-positive-result-scenario}
\end{figure}

The proposed approach is totally resilient to \textit{false-negative} results because any given vehicle may not send messages that describe the same event with different anonymity set digital certificates (property 4 of the proposed anonymity set multilevel architecture). Moreover, a set of messages that describe the same event and contain the same set of anonymity set digital certificate are kept as suspected by the neighboring vehicles. For instance, suppose that a malicious vehicle keeps sending beacon messages with different identities, but they contain only one anonymity set digital certificate. These messages are kept as suspected until Equation~\ref{eq:wait-time} is satisfied, or when Equation~\ref{eq:sybil-detection-eq} is satisfied, which leads to the prosecution phase. 

\section{Related Work}
\label{sec:related}

To the best of our knowledge, Lin et al~\cite{lin2007gsis} proposed one of the most efficient group-based authentication for VANETs. The approach is simple: each vehicle signs the whole message with its group signing key, and may verify the sender's message authenticity by using the group public key. However, the verification process based on group signatures are slower than traditional asymmetric key pairs, which reduces the number of message verification per second. For instance, it takes 8.5 \textit{ms} on average to verify any received message. Therefore, a vehicle may only verify 125 messages/s, which is very low in high traffic jam. In addition, the verification process does not consider the revocation lists, which is also time-consuming and is proportional to the number of revoked vehicles.  The \protocolname~protocol uses traditional public/private key pairs for message verification, which increases the verification rate. 

With respect to the \textit{sybil} attack detections, malicious users may launch and explore \textit{sybil} attacks in different types of networks, such as \textit{peer-to-peer} (P2P)~\cite{sybil}, sensor~\cite{sybil-survey3}, and mobile ad hoc networks~\cite{sybil-neighborhood1}. Moreover, the attack may compromise many types of applications, such as voting~\cite{tran2012combating}, reputation systems~\cite{reputation-sybil2}, as well as distributed storage and resource sharing systems~\cite{xiao2007security}, to name a few. Thus, there have been many approaches to avoid and detect \textit{sybil} attacks. 

Initially, Douceur~\cite{sybil} proposed the resource testing method. In short, Douceur's assumption requires that each physical entity is limited in resources such as computation, storage and communication. Hence, a \textit{sybil} entity would not perform a set of tasks in a given time interval as expected if these identities would belong to different entities. However, in ad hoc networks, one node may have more computational resources than other nodes. Similarly, in sensor networks, the radio resource testing, proposed by Newsome~\cite{sybil-survey3}, assumes that each physical entity has only one radio resource and is able to send and receive only on one channel simultaneously. This cannot be a realistic assumption on VANET.

Zhou et al.~\cite{p2dap2, p2dap} propose a privacy-preserving \textit{sybil} attack detection protocol called $P^{2}DAP$. First, a CA provides to every vehicle a pool of pseudonyms that are used for preserving the vehicle's privacy. To prevent \textit{sybil} attacks, the pseudonyms assigned to a particular vehicle are hashed to a common value called \textit{coarse-grained hash value}. Afterwards, the same pseudonyms are hashed to another hash value called \textit{fine-grained hash value}. Vehicles with the same coarse-grained values are grouped together, while the pseudonyms with fine-grained values are unique to each vehicle. To detect a \textit{sybil} attack, an RSU captures the messages sent from the vehicles along a road and verifies the \textit{course-grained hash values}. If two or more messages have the same \textit{coarse-grained hash values}, the RSU forwards the messages to the CA. The CA then verifies the \textit{fine-grained hash values} and checks if these values are also the same. If it evaluates to true, this vehicle is malicious (a \textit{sybil} vehicle). The drawback of such approach is that a \textit{sybil} attacker will not be detected if the CA is unavailable or there are no RSUs around. Hence, the approach is highly dependent on the RSU deployment methods and its availability (e.g.: DoS attack may compromise V2V communications). Moreover, experimental results show that a \textit{sybil} detection may achieve 20 seconds due to high overhead imposed on RSUs, which is a high average time for real world on-road services. On the other hand, our approach does not need a fixed infrastructure to avoid or detect \textit{sybil} attacks and, as well as for the same number of vehicles and \textit{sybil} attacker (e.g.: 90 vehicles, and one \textit{sybil} vehicle), our approach detects the \textit{sybil} attack faster than $P^{2}DAP$.

Another strategy for detecting \textit{sybil} attacks is based on a timestamp series approach~\cite{sybil-time-space1, sybil-time-space2, sybil-time-stamp1}. The approach explores the relationship between time and space, where two or more vehicles will not pass nearby the same RSU and send requests to it at the same time. Thus, an RSU issues digitally signed timestamps to each vehicle. Then, each vehicle must attach to beacon messages at least the last two timestamps. If two different messages with different identities contain the same last two timestamps, then they belong to a \textit{sybil} vehicle. This approach may compromise users' privacy since it requires vehicle authentication at each RSU, which allows third-party entities to assemble a vehicle routing profile. In addition, the scheme cannot be applied directly to an urban environment with a very complex roadway infrastructure, many signals and intersections, as deeply discussed in~\cite{sybil-time-stamp1}. Our approach does not depend on the roadway infrastructure.

Finally, a \textit{sybil} detection approach may use data from neighboring vehicles to filter malicious vehicles~\cite{sybil-neighborhood1, sybil-neighborhood3}. In Grover's et al. approach~\cite{sybil-neighborhood2}, every vehicle builds a neighboring table (which contains vehicles' identities) with different time interval. After this process, each vehicle shares its neighboring table with other vehicles. If every vehicle has the same neighbors' identities for different time intervals, then these identities may belong to the same (\textit{sybil}) vehicle. Nonetheless, a \textit{sybil} vehicle may never be detected (\textit{false-negative} results) if it changes its identities between consecutive time intervals. As previously discussed, our approach is resilient to \textit{false-negative} results. To sum up, if different vehicles stay together for a long period of time, then it results in \textit{false-positive} \textit{sybil} detections.

We compare our proposed privacy-preserving \textit{sybil} detection protocol to other similar approaches on Table~\ref{tab:comparison}. The main advantage of our scheme is it's resilience to \textit{false-negative} detection results without a centralized infrastructure during detection time, which imposes less overhead on RSUs and, therefore, significantly decreases the average time to detect \textit{sybil} attacks. The dependency on a centralized infrastructure may also compromise VANET services if a more sophisticated network attack also makes such infrastructure unavailable. 

\begin{center}
\begin{table}[ht]
\caption{Comparison to other approaches.}
{\small
\hfill{}
\begin{tabular}{cccccc}
\hline
 & \pbox{20cm}{False-Positive \\ False-Negative \\ Resilient}&  \pbox{20cm}{Non-\\Repudiation} &  \pbox{20cm}{Beacon \\ or \\ Event} &  \pbox{20cm}{Infrastructure-\\Dependent} & \pbox{20cm}{Roadway \\ Infrastructure- \\Dependent } \\
\hline
Our & \textbf{Negative} & Yes & Both & \textbf{No} & No\\ 
\cite{p2dap2} & Negative & Yes & Both & Yes & No\\
\cite{sybil-time-space1} & None & * & Both & Yes & Yes \\ 
\cite{sybil-time-space2} & None & * & Both & Yes & Yes \\ 
\cite{sybil-time-stamp1} & None & No & Both & Yes & Yes \\ 
\cite{sybil-neighborhood2} & None & * & Beacon & No & No \\ 
\cite{sybil-neighborhood3} & None & * & Beacon & No & No \\
\hline
\end{tabular}}
\hfill{}
\label{tab:comparison}
\scriptsize{*It depends on the authentication model.}
\end{table}
\end{center}

\section{Conclusion and Future Work}
\label{sec:conclusion}

In this paper we have presented a privacy-preserving authentication and \textit{sybil} detection protocol for vehicular ad hoc networks called~\protocolname. In order to provide users' privacy, the protocol provides a multilevel anonymity set architecture, with group signature and pseudonyms. The experimental results show that the proposed authentication approach is secure, and the \textit{sybil} detection protocol is acceptable with respect to detection time, once VANET requires low latency. Moreover, \protocolname~is also resilient to \textit{false-negative} detections without the support of centralized infrastructures during \textit{sybil} attack detection time.

The challenge in detecting \textit{sybil} attacks in VANETs resides in the potential threats to users' privacy, since during \textit{sybil} detection time, multiple identities must be linked to a one single, yet non-malicious, entity. According to Douceur~\cite{sybil}, without a logically, yet trusted centralized authority (CA), which will vouch for a one-to-one correspondence between entity and identity, \textit{sybil} attacks are always possible except under extreme and unrealistic assumptions of resource parity and coordination among entities. On the other hand, when a Certificate Authority may not be always available in VANETs, a potential solution for detecting \textit{sybil} attacks must consider only the vehicles in the region of attack, in which each vehicle must share control data in order to detect the attack. 

For future work, a kind of \textit{sybil attack signaling message} has been studied and aims at allowing one vehicle to announce to neighboring vehicles that there are two or more vehicles in the vicinity that belong to the same first level anonymity set. This signaling message aims to avoid \textit{false-positive} detections in hidden terminals scenarios (Figure~\ref{fig:false-positive-result-scenario}). For instance, vehicle B broadcasts signaling messages with identities A and C. Once all vehicles may listen to the \textit{signaling} messages, the vehicles A and C may detect that they are suspected and may attach the next anonymity set digital certificates in their next beacon messages.

The V2I communication type is the most important communication type that still must be evaluated. Vehicles and RSUs communicate to negotiate new sets of pseudonyms, as well as during the prosecution phase. The communication overhead, w.r.t. the network traffic, of both depends on the number of vehicles that send the renewal or prosecution messages to a given RSU. The former is a kind of \textit{three-way-handshake} protocol, which, at a first glance, does not impose high overhead on RSUs due to the low probability that a high number of vehicles need to change the set of pseudonyms at the same time. The last one tends to impose a high overhead on RSUs if there is a high number of vehicles that made part of a \textit{sybil} detection process at the same region and they send prosecution messages to the same RSU. In order to avoid the RSU from forwarding each single prosecution message to the CA, the RSU must first evaluate if the messages belong to the same \textit{sybil} detection process. This will avoid a CA from measuring redundant prosecution messages. Both V2I communications are still being evaluated.

As another future work, we are evaluating the achieved degree of anonymity of a given anonymity set $AS_{i,j}$. In other words, we would like to measure the probability of a malicious entity, which controls several sensors that are scattered across an entire city, to build a vehicle's route profile of a specific distance (e.g.: 3 \textit{km}) while the vehicle exposes the anonymity sets that it belongs to. Therefore, we are measuring a number of anonymity sets \textit{k} (for each level) that a vehicle must belong to in order to minimize the probability of the user's privacy violations. Based on the concepts of Shannon's entropy~\cite{shannon} and rough set theory~\cite{Dai201372}, as well as on the model to quantify the degree of anonymity of a set of users grouped in several subsets~\cite{diaz2002information}, the anonymity of a given anonymity set $AS_{i,j}$ may be evaluated. Therefore, it is also possible to define how vehicles may be allocated into the anonymity sets in order to maximize users' privacy with a low impact on message processing and data management overheads.

The security aspects are one of the biggest forthcoming challenges for actually deploying the concepts of VANET. The reliability of the whole system may not be compromised due to the high impact it has on people's lives. In this context, among other security-related concepts, authentication, non-repudiation, user's privacy control, and \textit{sybil} attack detections play key roles in vehicular environments and, therefore, they have gained a special attention from the research community.


%
%\begin{figure}
%
%\begin{minipage}{.5\linewidth}
%\centering
%\subfloat[]{\label{main:a}\includegraphics[scale=.35]{figures/grafico-resultados-nao-sybil-100-en.pdf}}
%\end{minipage}%
%\begin{minipage}{.5\linewidth}
%\centering
%\subfloat[]{\label{main:b}\includegraphics[scale=.35]{figures/grafico-resultados-nao-sybil-100-en.pdf}}
%\end{minipage}\par\medskip
%\centering
%\subfloat[]{\label{main:c}\includegraphics[scale=.35]{figures/grafico-resultados-nao-sybil-100-en.pdf}}
%
%\caption{my fig}
%\label{fig:main}
%\end{figure}


%% \linenumbers

%% main text


%% The Appendices part is started with the command \appendix;
%% appendix sections are then done as normal sections
%% \appendix

%% \section{}
%% \label{}

%% If you have bibdatabase file and want bibtex to generate the
%% bibitems, please use
%%
\bibliographystyle{elsarticle-num} 
\bibliography{biblio}

%% else use the following coding to input the bibitems directly in the
%% TeX file.

%\begin{thebibliography}{00}
%
%% \bibitem{label}
%% Text of bibliographic item
%
%\bibitem{}
%
%\end{thebibliography}
\end{document}
\endinput
%%
%% End of file `elsarticle-template-num.tex'.
